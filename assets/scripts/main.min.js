$(function() {
	String.prototype.decodeHTML = function() { return $("<div>", {html: "" + this}).html(); };

	var $page = $("#page"), $preloader = $("#preloader"), $counter = 0;

	checkUrl = function(slug) {
		var url = location.href;
		var regex = '^(http[s]?\:\/\/){0,1}(www\.){0,1}[a-zA-Z0-9\.\-\_\:]+(\/)?' + slug + '(\#)?(\/)?$';
		if (url.match(new RegExp(regex))) { return true; } else { return false; };
	},

	engineSideMenu = function() {

	},

	engineFormValidations = function() {
	},

	engineGraphs = function(graph, resource, title) {

	},

	enginePage = function() {
		$(document).foundation({});

		if (checkUrl("boards/[0-9]+")) {
			console.log('[INFO] enginePage called at: boards/[0-9]+.');

			var el = document.getElementById('boards');
			var sortable = new Sortable(el, {
			    group: { name: "boards", pull: true, put: true },  // or { name: "...", pull: [true, false, clone], put: [true, false, array] }
			    sort: true,  // sorting inside list
			    delay: 0, // time in milliseconds to define when the sorting should start
			    disabled: false, // Disables the sortable if set to true.
			    store: null,  // @see Store
			    animation: 150,  // ms, animation speed moving items when sorting, `0` — without animation
			    handle: ".board__header",  // Drag handle selector within list items
			    filter: ".ignore-elements",  // Selectors that do not lead to dragging (String or Function)
			    draggable: ".board",  // Specifies which items inside the element should be sortable
			    ghostClass: "sortable-ghost",  // Class name for the drop placeholder
			    dataIdAttr: 'data-id',

			    scroll: true, // or HTMLElement
			    scrollSensitivity: 30, // px, how near the mouse must be to an edge to start scrolling.
			    scrollSpeed: 10, // px

			    // Called by any change to the list (add / update / remove)
			    onSort: function (/**Event*/evt) {
			        // same properties as onUpdate
			        console.log(evt);

			        $('.board').each(function(index, el) {
			            $.get( "http://127.0.0.1:8000/update_board", { board_id: el.dataset.boardId, order: index } )
			        });
			    },

			});


			[].forEach.call(el.getElementsByClassName('board__tasks'), function (el){
			    Sortable.create(el, {
			        group: 'board__task',
			        ghostClass: "board__task-ghost",  // Class name for the drop placeholder
			        animation: 150,
			        filter: ".disabled",

			        // Element is dropped into the list from another list
			        onAdd: function (/**Event*/evt) {
			            console.log(evt);
			            var itemEl = evt.item;  // dragged HTMLElement
			            evt.from;  // previous list
			            // + indexes from onEnd

			            boardTarget = $(itemEl).closest(".board__tasks");
			            console.log((itemEl).closest(".board__tasks"));

			            $.get( "http://127.0.0.1:8000/update_task", { task_id: itemEl.dataset.taskId, board_id: boardTarget[0].dataset.fromBoard } )
			            // .done(function( data ) {
			            //     console( "Data Loaded: " + data );
			            // });
			        },
			    });
			});

		} else if (checkUrl("sprints/[0-9]+")) {
			console.log('[INFO] enginePage called at: sprints/[0-9]+.');

			$('.datepicker').pickadate({
		        formatSubmit: 'yyyy/mm/dd',
		    });

			var el = document.getElementById('board-sprints');
			var sortable = new Sortable(el, {
			    group: { name: "boards", pull: true, put: true },  // or { name: "...", pull: [true, false, clone], put: [true, false, array] }
			    sort: true,  // sorting inside list
			    delay: 0, // time in milliseconds to define when the sorting should start
			    disabled: false, // Disables the sortable if set to true.
			    store: null,  // @see Store
			    animation: 150,  // ms, animation speed moving items when sorting, `0` — without animation
			    handle: ".board__header",  // Drag handle selector within list items
			    filter: ".ignore-elements",  // Selectors that do not lead to dragging (String or Function)
			    draggable: ".board",  // Specifies which items inside the element should be sortable
			    ghostClass: "sortable-ghost",  // Class name for the drop placeholder
			    dataIdAttr: 'data-id',

			    scroll: true, // or HTMLElement
			    scrollSensitivity: 30, // px, how near the mouse must be to an edge to start scrolling.
			    scrollSpeed: 10, // px

			    // Called by any change to the list (add / update / remove)
			    onSort: function (/**Event*/evt) {
			        // same properties as onUpdate

			        $('.board').each(function(index, el) {
			            $.get( "http://127.0.0.1:8000/update_board", { board_id: el.dataset.boardId, order: index } )
			        });
			    },

			});


			[].forEach.call(el.getElementsByClassName('tasks'), function (el){
			    Sortable.create(el, {
			        group: 'task',
			        ghostClass: "board__task-ghost",  // Class name for the drop placeholder
			        animation: 150,
			        filter: ".disabled",

			        // Element is dropped into the list from another list
			        onAdd: function (/**Event*/evt) {
			            console.log(evt);
			            var itemEl = evt.item;  // dragged HTMLElement
			            evt.from;  // previous list
			            // + indexes from onEnd
			           	
			           	if ($(evt.target).attr('data-sprint-id')) {
				            $.get( "http://127.0.0.1:8000/update_task", { task_id: itemEl.dataset.taskId, sprint_id: evt.target.dataset.sprintId, order: evt.newIndex } )
			           	} else {
			           		$.get( "http://127.0.0.1:8000/update_task", { task_id: itemEl.dataset.taskId, sprint_id: 0 } )
			           	}
			        },
			        onSort: function (/**Event*/evt) {
				        // same properties as onUpdate
			           	$('.sprints .sprint .task').each(function(index, el) {
				            $.get( "http://127.0.0.1:8000/update_task", { task_id: el.dataset.taskId, order: index } )
				        });
				    },

			    });
			});

		} else {
			console.log('[INFO] enginePage called at generic page.');

			if ($('table#dashboard-simulated-test-graph-resource').length > 0) {
				var resource = $('table#dashboard-simulated-test-graph-resource tr').get().map(function(row) {
					return $(row).find('td').get().map(function(cell) {
						return $(cell).html();
					});
				});

				categories = [];
				for (i = 2; i < resource.length; ++i) {
					categories.push(resource[i][0]);
				}
				data = [];
				for (j = 1; j < resource[0].length; ++j) {
					data[j-1] = {};
					data[j-1]["data"] = [];
					data[j-1]["name"] = resource[0][j];
					data[j-1]["color"] = resource[1][j];

					for (k = 2; k < resource.length; ++k) {
						data[j-1]["data"].push(parseFloat(resource[k][j]));
					}
				}

				$('#dashboard-simulated-test-graph').highcharts({
					chart: {
						type: 'column',
						height: 220,
					},
					title: { text: ' '  },
					legend: {
						layout: 'horizontal',
						align: 'center',
						verticalAlign: 'top',
					},
					credits: false,
					xAxis: {
						categories: categories,
						crosshair: true
					},
					yAxis: {
						min: 0,
						max: 100,
						tickInterval: 20,
						title: {
							text: 'Porcentagem de acertos'
						}
					},
					tooltip: {
						headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
						pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
						'<td style="padding:0"><b>{point.y:.1f} %</b></td></tr>',
						footerFormat: '</table>',
						shared: true,
						useHTML: true
					},
					plotOptions: {
						column: {
							pointPadding: 0.2,
							borderWidth: 0
						}
					},
					series: data
				});
			}

			if ($('#flot-chart1').length > 0) {
				var d1 = [[1262304000000, 6], [1264982400000, 3057], [1267401600000, 20434], [1270080000000, 31982], [1272672000000, 26602], [1275350400000, 27826], [1277942400000, 24302], [1280620800000, 24237], [1283299200000, 21004], [1285891200000, 12144], [1288569600000, 10577], [1291161600000, 10295]];
				var d2 = [[1262304000000, 5], [1264982400000, 200], [1267401600000, 1605], [1270080000000, 6129], [1272672000000, 11643], [1275350400000, 19055], [1277942400000, 30062], [1280620800000, 39197], [1283299200000, 37000], [1285891200000, 27000], [1288569600000, 21000], [1291161600000, 17000]];

				var data1 = [
				{ label: "Data 1", data: d1, color: '#17a084'},
				{ label: "Data 2", data: d2, color: '#127e68' }
				];
				$.plot($("#flot-chart1"), data1, {
					xaxis: {
						tickDecimals: 0
					},
					series: {
						lines: {
							show: true,
							fill: true,
							fillColor: {
								colors: [{
									opacity: 1
								}, {
									opacity: 1
								}]
							},
						},
						points: {
							width: 0.1,
							show: false
						},
					},
					grid: {
						show: false,
						borderWidth: 0
					},
					legend: {
						show: false,
					}
				});
			}
		}
	},

	init = function() {
		engineSideMenu();
		enginePage();
		engineFormValidations();
	},

	ajaxLoad = function(html, status, xhr) {
		$counter++;
		console.log("- -- --- ---- ----- " + $counter + "º ajax call ----- ---- --- -- -");
		console.log("[INFO] Ajax Request Status: " + status);
		console.log("[INFO] Ajax Request XHR: " + xhr);
		if ( status == "error" ) {
			var msg = "Sorry but there was an error: ";
			alert(msg + xhr.status + " " + xhr.statusText);
		} else {
			// $preloader.hide( 500 );
			document.title = html
			.match(/<title>(.*?)<\/title>/)[1]
			.trim()
			.decodeHTML();
			init();
		}
	},

	loadPage = function(href) {
		$page.load(href + ' #page>*', ajaxLoad);
	};

	init();

	$(window).on("popstate", function(e) {
		if (e.originalEvent.state !== null) {
			loadPage(location.href);
		}
	});

	$(document).on("click", "a, [data-href]", function(ev) {
		var href = $(this).attr("href");
		var dataAjax = $(this).attr("data-ajax");

		if (dataAjax == "false" || href == undefined || href == '#') { return; }

		ev.preventDefault();

		if (href.indexOf(document.domain) > -1 || href.indexOf(':') === -1) {
			// $preloader.show( 500 );
			history.pushState({}, '', href);
			loadPage(href);
			return false;
		} else {
			console.log('[INFO] At: click.data-ajax');
		}
	});
});

// Regex summary
// . Any character except newline.
// \.  A period (and so on for \*, \(, \\, etc.)
// ^ The start of the string.
// $ The end of the string.
// \d,\w,\s  A digit, word character [A-Za-z0-9_], or whitespace.
// \D,\W,\S  Anything except a digit, word character, or whitespace.
// [abc] Character a, b, or c.
// [a-z] a through z.
// [^abc]  Any character except a, b, or c.
// aa|bb Either aa or bb.
// ? Zero or one of the preceding element.
// * Zero or more of the preceding element.
// + One or more of the preceding element.
// {n} Exactly n of the preceding element.
// {n,}  n or more of the preceding element.
// {m,n} Between m and n of the preceding element.
// ??,*?,+?,
// {n}?, etc.  Same as above, but as few as possible.
// (expr)  Capture expr for use with \1, etc.
// (?:expr)  Non-capturing group.
// (?=expr)  Followed by expr.
// (?!expr)  Not followed by expr.

// Foundation JavaScript
// Documentation can be found at: http://foundation.zurb.com/docs
$(document).foundation({});

/*  [GLOBAL] Functions
*******************************************************************/
  
  String.prototype.capitalizeFirstLetter = function() {
      return this.charAt(0).toUpperCase() + this.slice(1);
  }

  function getRandomColor() {
    var letters = '0123456789ABCDEF'.split('');
    var color = '#';
    for (var i = 0; i < 6; i++ ) {
      color += letters[Math.floor(Math.random() * 16)];
    }
    return color;
  }

  function lock_screen(){
  }

  function unlock_screen(){
  }

  function chain_of_events(el){
    if (el.attr('data-events-before-request')){
      var events = el.attr('data-events-before-request').split(' ');

      for (var i = 0;i < events.length; i++){
        e = events[i].toString();
        
        switch(e){
          case 'beActive':
            $('a[data-eventsBeforeRequest=beActive]').removeClass('active');
            el.addClass('active');

            break;
          case 'fadeOut':
            el.fadeOut();

            break;
          case 'addDataIndex':
            el = addDataIndex(el);

            break;
          case 'remove':
            if (events[i + 1]){
              $(events[i + 1]).fadeOut(1000, function(){ 
                $(this).remove();
              })
            } else {
              el.fadeOut(1000, function(){ 
                $(this).remove();
              })
            }
          default:
            break;
        }
      }
    }

    return el;
  }

  function process_data(data){
    console.log(data)
    if (data['alert-success']){
      alertify.success(data['alert-success']);
    } 

    if (data['alert-error']){
      alertify.error(data['alert-error']);
    }

    setTimeout(function() {
      if (data['redirect']){
        window.location.replace(data['redirect']);
      } else {
        if (data['href']){
          get(data['href']);        
        } else if (data['template']){
          if(data['target']){
            $(data['target']).html(data['template']);
          } else {
           $('#page').html(data['template']);
          }
        }

        // if (data['alert-success']){
        //   alertify.success(data['alert-success']);
        // } 

        // if (data['alert-error']){
        //   alertify.error(data['alert-error']);
        // }
      }
    }, 1000);
  }

  function before_load(){

  }

  function get(url, lock){
    var lock = (typeof lock === 'undefined') ? 'true' : lock;

    if (lock == 'true'){
      lock_screen();
    }

    $.ajax({
      url     : url,
      type    : 'get',
      cache   : false,
      success : function(data){
        process_data(data);
      },
      error   : function(data){
        alertify.error('Erro desconhecido, por favor entrar em contato com os administradores!');     
      },
      complete: function(data){
        before_load();

        if (lock == 'true'){
          unlock_screen();
        }
      }
    });
  }

  function post(form, lock){
    var lock = (typeof lock === 'undefined') ? 'true' : lock;   
    
    if (lock == 'true'){
      lock_screen(); 
    }

    if (form.attr('data-custom')){
      if (typeof window[form.attr('data-custom')] === 'function'){
        var data = window[form.attr('data-custom')](form);
      }
    } else {
      var data = form.serialize();
    }

    var content = (form.attr('data-content') == 'false') ? false : 'application/x-www-form-urlencoded; charset=UTF-8';
    var process = (form.attr('data-process') == 'false') ? false : true; 

    $.ajax({
      url     : form.attr('action'),
      type    : form.attr('method'),
      data    : data,
      cache   : false,
      contentType: content,
      processData: process,
      success : function(data){
        process_data(data);
      },
      error   : function(data){
        alertify.error('Erro desconhecido, por favor entrar em contato com os administradores!');    
      },
      complete: function(data){
        before_load();

        if (lock == 'true'){
          unlock_screen();
        }
      }
    });
  }

/*  [GLOBAL] Calls
*******************************************************************/

  $(document).on('click', 'a[data-get]', function(e){
    e.preventDefault();

    el = $(this);

    if (!el.hasClass('active')){

      if (el.attr('data-confirm')){
        alertify.set({ labels : { ok: "Sim", cancel: "NÃ£o" } });
        
        alertify.confirm(el.attr('data-confirm'), function (e) {
          if (e) {
            el = chain_of_events(el);

            get(el.attr('data-get'), el.attr('data-lock')); 
          } else {
            alertify.log('AÃ§Ã£o cancelada.')
          }
        });
      } else {
        el = chain_of_events(el);

        get(el.attr('data-get'), el.attr('data-lock'));
      }
    }
  });

  $(document).on('click', '[data-submit]', function(e){
    e.preventDefault();

    var el = $(this);
    var form = el.closest('form');
    var form_valid = true;
    var required_fields = form.find('[data-required]');

    required_fields.each(function(index){
      var field = $(this);
      var error_msg = field.attr('data-required');

      if (field.val() == '' || field.val() == 0){
        field.addClass('invalid');
        alertify.error(error_msg);
        form_valid = false;
      }
    });
    
    if (form.attr('data-default')){
      form.submit();
    } else if (form_valid){
      post(form, form.attr('data-lock'));
    } 

    return false;
  })

  $(document).on('submit', 'form', function(){
    var el = $(this);
    var form_valid = true;
    var required_fields = el.find('[data-required]');

    required_fields.each(function(index){
      var field = $(this);
      var error_msg = field.attr('data-required');

      if (field.val() == '' || field.val() == 0){
        field.addClass('invalid');
        alertify.error(error_msg);
        form_valid = false;
      }
    });
    
    if (el.attr('data-default')){
      return true;
    } else if (form_valid){
      post(el, el.attr('data-lock'));
    } 

    return false;
  });

  $('#visibility').change(function(){
       cb = $(this);
       cb.val(cb.prop('checked').toString().capitalizeFirstLetter());
   });  

  $(document).ready(function(){
    $('#page').css('min-height', $('body').height() - 100);

    $('.project-box').each(function(){
      // $(this).css('background-color', getRandomColor());
    });

    $('.datepicker').pickadate({
        formatSubmit: 'yyyy/mm/dd',
    });
  });

  $( window ).resize(function() {
    $('#page').css('min-height', $('body').height() - 100);
  });

  $(document).on('click', '.hero__meta-anchor-login', function() {
    $('.hero__forms-login form').stop().animate({
        width: "100%",
        opacity: 1,
      }, 1000);
    $('.hero__forms-signup form').stop().animate({
        width: "0",
        opacity: 0,
      }, 1000);
  });
  $(document).on('click', '.hero__meta-anchor-signup', function() {
    $('.hero__forms-signup form').stop().animate({
        width: "100%",
        opacity: 1,
      }, 1000);
    $('.hero__forms-login form').stop().animate({
        width: "0",
        opacity: 1,
      }, 1000);
  });

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFqYXhSZXF1ZXN0cy5qcyIsIm1haW4uanMiLCJzb3J0YWJsZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaFVBIiwiZmlsZSI6Im1haW4ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJChmdW5jdGlvbigpIHtcblx0U3RyaW5nLnByb3RvdHlwZS5kZWNvZGVIVE1MID0gZnVuY3Rpb24oKSB7IHJldHVybiAkKFwiPGRpdj5cIiwge2h0bWw6IFwiXCIgKyB0aGlzfSkuaHRtbCgpOyB9O1xuXG5cdHZhciAkcGFnZSA9ICQoXCIjcGFnZVwiKSwgJHByZWxvYWRlciA9ICQoXCIjcHJlbG9hZGVyXCIpLCAkY291bnRlciA9IDA7XG5cblx0Y2hlY2tVcmwgPSBmdW5jdGlvbihzbHVnKSB7XG5cdFx0dmFyIHVybCA9IGxvY2F0aW9uLmhyZWY7XG5cdFx0dmFyIHJlZ2V4ID0gJ14oaHR0cFtzXT9cXDpcXC9cXC8pezAsMX0od3d3XFwuKXswLDF9W2EtekEtWjAtOVxcLlxcLVxcX1xcOl0rKFxcLyk/JyArIHNsdWcgKyAnKFxcIyk/KFxcLyk/JCc7XG5cdFx0aWYgKHVybC5tYXRjaChuZXcgUmVnRXhwKHJlZ2V4KSkpIHsgcmV0dXJuIHRydWU7IH0gZWxzZSB7IHJldHVybiBmYWxzZTsgfTtcblx0fSxcblxuXHRlbmdpbmVTaWRlTWVudSA9IGZ1bmN0aW9uKCkge1xuXG5cdH0sXG5cblx0ZW5naW5lRm9ybVZhbGlkYXRpb25zID0gZnVuY3Rpb24oKSB7XG5cdH0sXG5cblx0ZW5naW5lR3JhcGhzID0gZnVuY3Rpb24oZ3JhcGgsIHJlc291cmNlLCB0aXRsZSkge1xuXG5cdH0sXG5cblx0ZW5naW5lUGFnZSA9IGZ1bmN0aW9uKCkge1xuXHRcdCQoZG9jdW1lbnQpLmZvdW5kYXRpb24oe30pO1xuXG5cdFx0aWYgKGNoZWNrVXJsKFwiYm9hcmRzL1swLTldK1wiKSkge1xuXHRcdFx0Y29uc29sZS5sb2coJ1tJTkZPXSBlbmdpbmVQYWdlIGNhbGxlZCBhdDogYm9hcmRzL1swLTldKy4nKTtcblxuXHRcdFx0dmFyIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JvYXJkcycpO1xuXHRcdFx0dmFyIHNvcnRhYmxlID0gbmV3IFNvcnRhYmxlKGVsLCB7XG5cdFx0XHQgICAgZ3JvdXA6IHsgbmFtZTogXCJib2FyZHNcIiwgcHVsbDogdHJ1ZSwgcHV0OiB0cnVlIH0sICAvLyBvciB7IG5hbWU6IFwiLi4uXCIsIHB1bGw6IFt0cnVlLCBmYWxzZSwgY2xvbmVdLCBwdXQ6IFt0cnVlLCBmYWxzZSwgYXJyYXldIH1cblx0XHRcdCAgICBzb3J0OiB0cnVlLCAgLy8gc29ydGluZyBpbnNpZGUgbGlzdFxuXHRcdFx0ICAgIGRlbGF5OiAwLCAvLyB0aW1lIGluIG1pbGxpc2Vjb25kcyB0byBkZWZpbmUgd2hlbiB0aGUgc29ydGluZyBzaG91bGQgc3RhcnRcblx0XHRcdCAgICBkaXNhYmxlZDogZmFsc2UsIC8vIERpc2FibGVzIHRoZSBzb3J0YWJsZSBpZiBzZXQgdG8gdHJ1ZS5cblx0XHRcdCAgICBzdG9yZTogbnVsbCwgIC8vIEBzZWUgU3RvcmVcblx0XHRcdCAgICBhbmltYXRpb246IDE1MCwgIC8vIG1zLCBhbmltYXRpb24gc3BlZWQgbW92aW5nIGl0ZW1zIHdoZW4gc29ydGluZywgYDBgIOKAlCB3aXRob3V0IGFuaW1hdGlvblxuXHRcdFx0ICAgIGhhbmRsZTogXCIuYm9hcmRfX2hlYWRlclwiLCAgLy8gRHJhZyBoYW5kbGUgc2VsZWN0b3Igd2l0aGluIGxpc3QgaXRlbXNcblx0XHRcdCAgICBmaWx0ZXI6IFwiLmlnbm9yZS1lbGVtZW50c1wiLCAgLy8gU2VsZWN0b3JzIHRoYXQgZG8gbm90IGxlYWQgdG8gZHJhZ2dpbmcgKFN0cmluZyBvciBGdW5jdGlvbilcblx0XHRcdCAgICBkcmFnZ2FibGU6IFwiLmJvYXJkXCIsICAvLyBTcGVjaWZpZXMgd2hpY2ggaXRlbXMgaW5zaWRlIHRoZSBlbGVtZW50IHNob3VsZCBiZSBzb3J0YWJsZVxuXHRcdFx0ICAgIGdob3N0Q2xhc3M6IFwic29ydGFibGUtZ2hvc3RcIiwgIC8vIENsYXNzIG5hbWUgZm9yIHRoZSBkcm9wIHBsYWNlaG9sZGVyXG5cdFx0XHQgICAgZGF0YUlkQXR0cjogJ2RhdGEtaWQnLFxuXG5cdFx0XHQgICAgc2Nyb2xsOiB0cnVlLCAvLyBvciBIVE1MRWxlbWVudFxuXHRcdFx0ICAgIHNjcm9sbFNlbnNpdGl2aXR5OiAzMCwgLy8gcHgsIGhvdyBuZWFyIHRoZSBtb3VzZSBtdXN0IGJlIHRvIGFuIGVkZ2UgdG8gc3RhcnQgc2Nyb2xsaW5nLlxuXHRcdFx0ICAgIHNjcm9sbFNwZWVkOiAxMCwgLy8gcHhcblxuXHRcdFx0ICAgIC8vIENhbGxlZCBieSBhbnkgY2hhbmdlIHRvIHRoZSBsaXN0IChhZGQgLyB1cGRhdGUgLyByZW1vdmUpXG5cdFx0XHQgICAgb25Tb3J0OiBmdW5jdGlvbiAoLyoqRXZlbnQqL2V2dCkge1xuXHRcdFx0ICAgICAgICAvLyBzYW1lIHByb3BlcnRpZXMgYXMgb25VcGRhdGVcblx0XHRcdCAgICAgICAgY29uc29sZS5sb2coZXZ0KTtcblxuXHRcdFx0ICAgICAgICAkKCcuYm9hcmQnKS5lYWNoKGZ1bmN0aW9uKGluZGV4LCBlbCkge1xuXHRcdFx0ICAgICAgICAgICAgJC5nZXQoIFwiaHR0cDovLzEyNy4wLjAuMTo4MDAwL3VwZGF0ZV9ib2FyZFwiLCB7IGJvYXJkX2lkOiBlbC5kYXRhc2V0LmJvYXJkSWQsIG9yZGVyOiBpbmRleCB9IClcblx0XHRcdCAgICAgICAgfSk7XG5cdFx0XHQgICAgfSxcblxuXHRcdFx0fSk7XG5cblxuXHRcdFx0W10uZm9yRWFjaC5jYWxsKGVsLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2JvYXJkX190YXNrcycpLCBmdW5jdGlvbiAoZWwpe1xuXHRcdFx0ICAgIFNvcnRhYmxlLmNyZWF0ZShlbCwge1xuXHRcdFx0ICAgICAgICBncm91cDogJ2JvYXJkX190YXNrJyxcblx0XHRcdCAgICAgICAgZ2hvc3RDbGFzczogXCJib2FyZF9fdGFzay1naG9zdFwiLCAgLy8gQ2xhc3MgbmFtZSBmb3IgdGhlIGRyb3AgcGxhY2Vob2xkZXJcblx0XHRcdCAgICAgICAgYW5pbWF0aW9uOiAxNTAsXG5cdFx0XHQgICAgICAgIGZpbHRlcjogXCIuZGlzYWJsZWRcIixcblxuXHRcdFx0ICAgICAgICAvLyBFbGVtZW50IGlzIGRyb3BwZWQgaW50byB0aGUgbGlzdCBmcm9tIGFub3RoZXIgbGlzdFxuXHRcdFx0ICAgICAgICBvbkFkZDogZnVuY3Rpb24gKC8qKkV2ZW50Ki9ldnQpIHtcblx0XHRcdCAgICAgICAgICAgIGNvbnNvbGUubG9nKGV2dCk7XG5cdFx0XHQgICAgICAgICAgICB2YXIgaXRlbUVsID0gZXZ0Lml0ZW07ICAvLyBkcmFnZ2VkIEhUTUxFbGVtZW50XG5cdFx0XHQgICAgICAgICAgICBldnQuZnJvbTsgIC8vIHByZXZpb3VzIGxpc3Rcblx0XHRcdCAgICAgICAgICAgIC8vICsgaW5kZXhlcyBmcm9tIG9uRW5kXG5cblx0XHRcdCAgICAgICAgICAgIGJvYXJkVGFyZ2V0ID0gJChpdGVtRWwpLmNsb3Nlc3QoXCIuYm9hcmRfX3Rhc2tzXCIpO1xuXHRcdFx0ICAgICAgICAgICAgY29uc29sZS5sb2coKGl0ZW1FbCkuY2xvc2VzdChcIi5ib2FyZF9fdGFza3NcIikpO1xuXG5cdFx0XHQgICAgICAgICAgICAkLmdldCggXCJodHRwOi8vMTI3LjAuMC4xOjgwMDAvdXBkYXRlX3Rhc2tcIiwgeyB0YXNrX2lkOiBpdGVtRWwuZGF0YXNldC50YXNrSWQsIGJvYXJkX2lkOiBib2FyZFRhcmdldFswXS5kYXRhc2V0LmZyb21Cb2FyZCB9IClcblx0XHRcdCAgICAgICAgICAgIC8vIC5kb25lKGZ1bmN0aW9uKCBkYXRhICkge1xuXHRcdFx0ICAgICAgICAgICAgLy8gICAgIGNvbnNvbGUoIFwiRGF0YSBMb2FkZWQ6IFwiICsgZGF0YSApO1xuXHRcdFx0ICAgICAgICAgICAgLy8gfSk7XG5cdFx0XHQgICAgICAgIH0sXG5cdFx0XHQgICAgfSk7XG5cdFx0XHR9KTtcblxuXHRcdH0gZWxzZSBpZiAoY2hlY2tVcmwoXCJzcHJpbnRzL1swLTldK1wiKSkge1xuXHRcdFx0Y29uc29sZS5sb2coJ1tJTkZPXSBlbmdpbmVQYWdlIGNhbGxlZCBhdDogc3ByaW50cy9bMC05XSsuJyk7XG5cblx0XHRcdCQoJy5kYXRlcGlja2VyJykucGlja2FkYXRlKHtcblx0XHQgICAgICAgIGZvcm1hdFN1Ym1pdDogJ3l5eXkvbW0vZGQnLFxuXHRcdCAgICB9KTtcblxuXHRcdFx0dmFyIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JvYXJkLXNwcmludHMnKTtcblx0XHRcdHZhciBzb3J0YWJsZSA9IG5ldyBTb3J0YWJsZShlbCwge1xuXHRcdFx0ICAgIGdyb3VwOiB7IG5hbWU6IFwiYm9hcmRzXCIsIHB1bGw6IHRydWUsIHB1dDogdHJ1ZSB9LCAgLy8gb3IgeyBuYW1lOiBcIi4uLlwiLCBwdWxsOiBbdHJ1ZSwgZmFsc2UsIGNsb25lXSwgcHV0OiBbdHJ1ZSwgZmFsc2UsIGFycmF5XSB9XG5cdFx0XHQgICAgc29ydDogdHJ1ZSwgIC8vIHNvcnRpbmcgaW5zaWRlIGxpc3Rcblx0XHRcdCAgICBkZWxheTogMCwgLy8gdGltZSBpbiBtaWxsaXNlY29uZHMgdG8gZGVmaW5lIHdoZW4gdGhlIHNvcnRpbmcgc2hvdWxkIHN0YXJ0XG5cdFx0XHQgICAgZGlzYWJsZWQ6IGZhbHNlLCAvLyBEaXNhYmxlcyB0aGUgc29ydGFibGUgaWYgc2V0IHRvIHRydWUuXG5cdFx0XHQgICAgc3RvcmU6IG51bGwsICAvLyBAc2VlIFN0b3JlXG5cdFx0XHQgICAgYW5pbWF0aW9uOiAxNTAsICAvLyBtcywgYW5pbWF0aW9uIHNwZWVkIG1vdmluZyBpdGVtcyB3aGVuIHNvcnRpbmcsIGAwYCDigJQgd2l0aG91dCBhbmltYXRpb25cblx0XHRcdCAgICBoYW5kbGU6IFwiLmJvYXJkX19oZWFkZXJcIiwgIC8vIERyYWcgaGFuZGxlIHNlbGVjdG9yIHdpdGhpbiBsaXN0IGl0ZW1zXG5cdFx0XHQgICAgZmlsdGVyOiBcIi5pZ25vcmUtZWxlbWVudHNcIiwgIC8vIFNlbGVjdG9ycyB0aGF0IGRvIG5vdCBsZWFkIHRvIGRyYWdnaW5nIChTdHJpbmcgb3IgRnVuY3Rpb24pXG5cdFx0XHQgICAgZHJhZ2dhYmxlOiBcIi5ib2FyZFwiLCAgLy8gU3BlY2lmaWVzIHdoaWNoIGl0ZW1zIGluc2lkZSB0aGUgZWxlbWVudCBzaG91bGQgYmUgc29ydGFibGVcblx0XHRcdCAgICBnaG9zdENsYXNzOiBcInNvcnRhYmxlLWdob3N0XCIsICAvLyBDbGFzcyBuYW1lIGZvciB0aGUgZHJvcCBwbGFjZWhvbGRlclxuXHRcdFx0ICAgIGRhdGFJZEF0dHI6ICdkYXRhLWlkJyxcblxuXHRcdFx0ICAgIHNjcm9sbDogdHJ1ZSwgLy8gb3IgSFRNTEVsZW1lbnRcblx0XHRcdCAgICBzY3JvbGxTZW5zaXRpdml0eTogMzAsIC8vIHB4LCBob3cgbmVhciB0aGUgbW91c2UgbXVzdCBiZSB0byBhbiBlZGdlIHRvIHN0YXJ0IHNjcm9sbGluZy5cblx0XHRcdCAgICBzY3JvbGxTcGVlZDogMTAsIC8vIHB4XG5cblx0XHRcdCAgICAvLyBDYWxsZWQgYnkgYW55IGNoYW5nZSB0byB0aGUgbGlzdCAoYWRkIC8gdXBkYXRlIC8gcmVtb3ZlKVxuXHRcdFx0ICAgIG9uU29ydDogZnVuY3Rpb24gKC8qKkV2ZW50Ki9ldnQpIHtcblx0XHRcdCAgICAgICAgLy8gc2FtZSBwcm9wZXJ0aWVzIGFzIG9uVXBkYXRlXG5cblx0XHRcdCAgICAgICAgJCgnLmJvYXJkJykuZWFjaChmdW5jdGlvbihpbmRleCwgZWwpIHtcblx0XHRcdCAgICAgICAgICAgICQuZ2V0KCBcImh0dHA6Ly8xMjcuMC4wLjE6ODAwMC91cGRhdGVfYm9hcmRcIiwgeyBib2FyZF9pZDogZWwuZGF0YXNldC5ib2FyZElkLCBvcmRlcjogaW5kZXggfSApXG5cdFx0XHQgICAgICAgIH0pO1xuXHRcdFx0ICAgIH0sXG5cblx0XHRcdH0pO1xuXG5cblx0XHRcdFtdLmZvckVhY2guY2FsbChlbC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCd0YXNrcycpLCBmdW5jdGlvbiAoZWwpe1xuXHRcdFx0ICAgIFNvcnRhYmxlLmNyZWF0ZShlbCwge1xuXHRcdFx0ICAgICAgICBncm91cDogJ3Rhc2snLFxuXHRcdFx0ICAgICAgICBnaG9zdENsYXNzOiBcImJvYXJkX190YXNrLWdob3N0XCIsICAvLyBDbGFzcyBuYW1lIGZvciB0aGUgZHJvcCBwbGFjZWhvbGRlclxuXHRcdFx0ICAgICAgICBhbmltYXRpb246IDE1MCxcblx0XHRcdCAgICAgICAgZmlsdGVyOiBcIi5kaXNhYmxlZFwiLFxuXG5cdFx0XHQgICAgICAgIC8vIEVsZW1lbnQgaXMgZHJvcHBlZCBpbnRvIHRoZSBsaXN0IGZyb20gYW5vdGhlciBsaXN0XG5cdFx0XHQgICAgICAgIG9uQWRkOiBmdW5jdGlvbiAoLyoqRXZlbnQqL2V2dCkge1xuXHRcdFx0ICAgICAgICAgICAgY29uc29sZS5sb2coZXZ0KTtcblx0XHRcdCAgICAgICAgICAgIHZhciBpdGVtRWwgPSBldnQuaXRlbTsgIC8vIGRyYWdnZWQgSFRNTEVsZW1lbnRcblx0XHRcdCAgICAgICAgICAgIGV2dC5mcm9tOyAgLy8gcHJldmlvdXMgbGlzdFxuXHRcdFx0ICAgICAgICAgICAgLy8gKyBpbmRleGVzIGZyb20gb25FbmRcblx0XHRcdCAgICAgICAgICAgXHRcblx0XHRcdCAgICAgICAgICAgXHRpZiAoJChldnQudGFyZ2V0KS5hdHRyKCdkYXRhLXNwcmludC1pZCcpKSB7XG5cdFx0XHRcdCAgICAgICAgICAgICQuZ2V0KCBcImh0dHA6Ly8xMjcuMC4wLjE6ODAwMC91cGRhdGVfdGFza1wiLCB7IHRhc2tfaWQ6IGl0ZW1FbC5kYXRhc2V0LnRhc2tJZCwgc3ByaW50X2lkOiBldnQudGFyZ2V0LmRhdGFzZXQuc3ByaW50SWQsIG9yZGVyOiBldnQubmV3SW5kZXggfSApXG5cdFx0XHQgICAgICAgICAgIFx0fSBlbHNlIHtcblx0XHRcdCAgICAgICAgICAgXHRcdCQuZ2V0KCBcImh0dHA6Ly8xMjcuMC4wLjE6ODAwMC91cGRhdGVfdGFza1wiLCB7IHRhc2tfaWQ6IGl0ZW1FbC5kYXRhc2V0LnRhc2tJZCwgc3ByaW50X2lkOiAwIH0gKVxuXHRcdFx0ICAgICAgICAgICBcdH1cblx0XHRcdCAgICAgICAgfSxcblx0XHRcdCAgICAgICAgb25Tb3J0OiBmdW5jdGlvbiAoLyoqRXZlbnQqL2V2dCkge1xuXHRcdFx0XHQgICAgICAgIC8vIHNhbWUgcHJvcGVydGllcyBhcyBvblVwZGF0ZVxuXHRcdFx0ICAgICAgICAgICBcdCQoJy5zcHJpbnRzIC5zcHJpbnQgLnRhc2snKS5lYWNoKGZ1bmN0aW9uKGluZGV4LCBlbCkge1xuXHRcdFx0XHQgICAgICAgICAgICAkLmdldCggXCJodHRwOi8vMTI3LjAuMC4xOjgwMDAvdXBkYXRlX3Rhc2tcIiwgeyB0YXNrX2lkOiBlbC5kYXRhc2V0LnRhc2tJZCwgb3JkZXI6IGluZGV4IH0gKVxuXHRcdFx0XHQgICAgICAgIH0pO1xuXHRcdFx0XHQgICAgfSxcblxuXHRcdFx0ICAgIH0pO1xuXHRcdFx0fSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0Y29uc29sZS5sb2coJ1tJTkZPXSBlbmdpbmVQYWdlIGNhbGxlZCBhdCBnZW5lcmljIHBhZ2UuJyk7XG5cblx0XHRcdGlmICgkKCd0YWJsZSNkYXNoYm9hcmQtc2ltdWxhdGVkLXRlc3QtZ3JhcGgtcmVzb3VyY2UnKS5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdHZhciByZXNvdXJjZSA9ICQoJ3RhYmxlI2Rhc2hib2FyZC1zaW11bGF0ZWQtdGVzdC1ncmFwaC1yZXNvdXJjZSB0cicpLmdldCgpLm1hcChmdW5jdGlvbihyb3cpIHtcblx0XHRcdFx0XHRyZXR1cm4gJChyb3cpLmZpbmQoJ3RkJykuZ2V0KCkubWFwKGZ1bmN0aW9uKGNlbGwpIHtcblx0XHRcdFx0XHRcdHJldHVybiAkKGNlbGwpLmh0bWwoKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0Y2F0ZWdvcmllcyA9IFtdO1xuXHRcdFx0XHRmb3IgKGkgPSAyOyBpIDwgcmVzb3VyY2UubGVuZ3RoOyArK2kpIHtcblx0XHRcdFx0XHRjYXRlZ29yaWVzLnB1c2gocmVzb3VyY2VbaV1bMF0pO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGRhdGEgPSBbXTtcblx0XHRcdFx0Zm9yIChqID0gMTsgaiA8IHJlc291cmNlWzBdLmxlbmd0aDsgKytqKSB7XG5cdFx0XHRcdFx0ZGF0YVtqLTFdID0ge307XG5cdFx0XHRcdFx0ZGF0YVtqLTFdW1wiZGF0YVwiXSA9IFtdO1xuXHRcdFx0XHRcdGRhdGFbai0xXVtcIm5hbWVcIl0gPSByZXNvdXJjZVswXVtqXTtcblx0XHRcdFx0XHRkYXRhW2otMV1bXCJjb2xvclwiXSA9IHJlc291cmNlWzFdW2pdO1xuXG5cdFx0XHRcdFx0Zm9yIChrID0gMjsgayA8IHJlc291cmNlLmxlbmd0aDsgKytrKSB7XG5cdFx0XHRcdFx0XHRkYXRhW2otMV1bXCJkYXRhXCJdLnB1c2gocGFyc2VGbG9hdChyZXNvdXJjZVtrXVtqXSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdCQoJyNkYXNoYm9hcmQtc2ltdWxhdGVkLXRlc3QtZ3JhcGgnKS5oaWdoY2hhcnRzKHtcblx0XHRcdFx0XHRjaGFydDoge1xuXHRcdFx0XHRcdFx0dHlwZTogJ2NvbHVtbicsXG5cdFx0XHRcdFx0XHRoZWlnaHQ6IDIyMCxcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdHRpdGxlOiB7IHRleHQ6ICcgJyAgfSxcblx0XHRcdFx0XHRsZWdlbmQ6IHtcblx0XHRcdFx0XHRcdGxheW91dDogJ2hvcml6b250YWwnLFxuXHRcdFx0XHRcdFx0YWxpZ246ICdjZW50ZXInLFxuXHRcdFx0XHRcdFx0dmVydGljYWxBbGlnbjogJ3RvcCcsXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRjcmVkaXRzOiBmYWxzZSxcblx0XHRcdFx0XHR4QXhpczoge1xuXHRcdFx0XHRcdFx0Y2F0ZWdvcmllczogY2F0ZWdvcmllcyxcblx0XHRcdFx0XHRcdGNyb3NzaGFpcjogdHJ1ZVxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0eUF4aXM6IHtcblx0XHRcdFx0XHRcdG1pbjogMCxcblx0XHRcdFx0XHRcdG1heDogMTAwLFxuXHRcdFx0XHRcdFx0dGlja0ludGVydmFsOiAyMCxcblx0XHRcdFx0XHRcdHRpdGxlOiB7XG5cdFx0XHRcdFx0XHRcdHRleHQ6ICdQb3JjZW50YWdlbSBkZSBhY2VydG9zJ1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0dG9vbHRpcDoge1xuXHRcdFx0XHRcdFx0aGVhZGVyRm9ybWF0OiAnPHNwYW4gc3R5bGU9XCJmb250LXNpemU6MTBweFwiPntwb2ludC5rZXl9PC9zcGFuPjx0YWJsZT4nLFxuXHRcdFx0XHRcdFx0cG9pbnRGb3JtYXQ6ICc8dHI+PHRkIHN0eWxlPVwiY29sb3I6e3Nlcmllcy5jb2xvcn07cGFkZGluZzowXCI+e3Nlcmllcy5uYW1lfTogPC90ZD4nICtcblx0XHRcdFx0XHRcdCc8dGQgc3R5bGU9XCJwYWRkaW5nOjBcIj48Yj57cG9pbnQueTouMWZ9ICU8L2I+PC90ZD48L3RyPicsXG5cdFx0XHRcdFx0XHRmb290ZXJGb3JtYXQ6ICc8L3RhYmxlPicsXG5cdFx0XHRcdFx0XHRzaGFyZWQ6IHRydWUsXG5cdFx0XHRcdFx0XHR1c2VIVE1MOiB0cnVlXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRwbG90T3B0aW9uczoge1xuXHRcdFx0XHRcdFx0Y29sdW1uOiB7XG5cdFx0XHRcdFx0XHRcdHBvaW50UGFkZGluZzogMC4yLFxuXHRcdFx0XHRcdFx0XHRib3JkZXJXaWR0aDogMFxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0c2VyaWVzOiBkYXRhXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoJCgnI2Zsb3QtY2hhcnQxJykubGVuZ3RoID4gMCkge1xuXHRcdFx0XHR2YXIgZDEgPSBbWzEyNjIzMDQwMDAwMDAsIDZdLCBbMTI2NDk4MjQwMDAwMCwgMzA1N10sIFsxMjY3NDAxNjAwMDAwLCAyMDQzNF0sIFsxMjcwMDgwMDAwMDAwLCAzMTk4Ml0sIFsxMjcyNjcyMDAwMDAwLCAyNjYwMl0sIFsxMjc1MzUwNDAwMDAwLCAyNzgyNl0sIFsxMjc3OTQyNDAwMDAwLCAyNDMwMl0sIFsxMjgwNjIwODAwMDAwLCAyNDIzN10sIFsxMjgzMjk5MjAwMDAwLCAyMTAwNF0sIFsxMjg1ODkxMjAwMDAwLCAxMjE0NF0sIFsxMjg4NTY5NjAwMDAwLCAxMDU3N10sIFsxMjkxMTYxNjAwMDAwLCAxMDI5NV1dO1xuXHRcdFx0XHR2YXIgZDIgPSBbWzEyNjIzMDQwMDAwMDAsIDVdLCBbMTI2NDk4MjQwMDAwMCwgMjAwXSwgWzEyNjc0MDE2MDAwMDAsIDE2MDVdLCBbMTI3MDA4MDAwMDAwMCwgNjEyOV0sIFsxMjcyNjcyMDAwMDAwLCAxMTY0M10sIFsxMjc1MzUwNDAwMDAwLCAxOTA1NV0sIFsxMjc3OTQyNDAwMDAwLCAzMDA2Ml0sIFsxMjgwNjIwODAwMDAwLCAzOTE5N10sIFsxMjgzMjk5MjAwMDAwLCAzNzAwMF0sIFsxMjg1ODkxMjAwMDAwLCAyNzAwMF0sIFsxMjg4NTY5NjAwMDAwLCAyMTAwMF0sIFsxMjkxMTYxNjAwMDAwLCAxNzAwMF1dO1xuXG5cdFx0XHRcdHZhciBkYXRhMSA9IFtcblx0XHRcdFx0eyBsYWJlbDogXCJEYXRhIDFcIiwgZGF0YTogZDEsIGNvbG9yOiAnIzE3YTA4NCd9LFxuXHRcdFx0XHR7IGxhYmVsOiBcIkRhdGEgMlwiLCBkYXRhOiBkMiwgY29sb3I6ICcjMTI3ZTY4JyB9XG5cdFx0XHRcdF07XG5cdFx0XHRcdCQucGxvdCgkKFwiI2Zsb3QtY2hhcnQxXCIpLCBkYXRhMSwge1xuXHRcdFx0XHRcdHhheGlzOiB7XG5cdFx0XHRcdFx0XHR0aWNrRGVjaW1hbHM6IDBcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdHNlcmllczoge1xuXHRcdFx0XHRcdFx0bGluZXM6IHtcblx0XHRcdFx0XHRcdFx0c2hvdzogdHJ1ZSxcblx0XHRcdFx0XHRcdFx0ZmlsbDogdHJ1ZSxcblx0XHRcdFx0XHRcdFx0ZmlsbENvbG9yOiB7XG5cdFx0XHRcdFx0XHRcdFx0Y29sb3JzOiBbe1xuXHRcdFx0XHRcdFx0XHRcdFx0b3BhY2l0eTogMVxuXHRcdFx0XHRcdFx0XHRcdH0sIHtcblx0XHRcdFx0XHRcdFx0XHRcdG9wYWNpdHk6IDFcblx0XHRcdFx0XHRcdFx0XHR9XVxuXHRcdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdHBvaW50czoge1xuXHRcdFx0XHRcdFx0XHR3aWR0aDogMC4xLFxuXHRcdFx0XHRcdFx0XHRzaG93OiBmYWxzZVxuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdGdyaWQ6IHtcblx0XHRcdFx0XHRcdHNob3c6IGZhbHNlLFxuXHRcdFx0XHRcdFx0Ym9yZGVyV2lkdGg6IDBcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdGxlZ2VuZDoge1xuXHRcdFx0XHRcdFx0c2hvdzogZmFsc2UsXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cdH0sXG5cblx0aW5pdCA9IGZ1bmN0aW9uKCkge1xuXHRcdGVuZ2luZVNpZGVNZW51KCk7XG5cdFx0ZW5naW5lUGFnZSgpO1xuXHRcdGVuZ2luZUZvcm1WYWxpZGF0aW9ucygpO1xuXHR9LFxuXG5cdGFqYXhMb2FkID0gZnVuY3Rpb24oaHRtbCwgc3RhdHVzLCB4aHIpIHtcblx0XHQkY291bnRlcisrO1xuXHRcdGNvbnNvbGUubG9nKFwiLSAtLSAtLS0gLS0tLSAtLS0tLSBcIiArICRjb3VudGVyICsgXCLCuiBhamF4IGNhbGwgLS0tLS0gLS0tLSAtLS0gLS0gLVwiKTtcblx0XHRjb25zb2xlLmxvZyhcIltJTkZPXSBBamF4IFJlcXVlc3QgU3RhdHVzOiBcIiArIHN0YXR1cyk7XG5cdFx0Y29uc29sZS5sb2coXCJbSU5GT10gQWpheCBSZXF1ZXN0IFhIUjogXCIgKyB4aHIpO1xuXHRcdGlmICggc3RhdHVzID09IFwiZXJyb3JcIiApIHtcblx0XHRcdHZhciBtc2cgPSBcIlNvcnJ5IGJ1dCB0aGVyZSB3YXMgYW4gZXJyb3I6IFwiO1xuXHRcdFx0YWxlcnQobXNnICsgeGhyLnN0YXR1cyArIFwiIFwiICsgeGhyLnN0YXR1c1RleHQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQvLyAkcHJlbG9hZGVyLmhpZGUoIDUwMCApO1xuXHRcdFx0ZG9jdW1lbnQudGl0bGUgPSBodG1sXG5cdFx0XHQubWF0Y2goLzx0aXRsZT4oLio/KTxcXC90aXRsZT4vKVsxXVxuXHRcdFx0LnRyaW0oKVxuXHRcdFx0LmRlY29kZUhUTUwoKTtcblx0XHRcdGluaXQoKTtcblx0XHR9XG5cdH0sXG5cblx0bG9hZFBhZ2UgPSBmdW5jdGlvbihocmVmKSB7XG5cdFx0JHBhZ2UubG9hZChocmVmICsgJyAjcGFnZT4qJywgYWpheExvYWQpO1xuXHR9O1xuXG5cdGluaXQoKTtcblxuXHQkKHdpbmRvdykub24oXCJwb3BzdGF0ZVwiLCBmdW5jdGlvbihlKSB7XG5cdFx0aWYgKGUub3JpZ2luYWxFdmVudC5zdGF0ZSAhPT0gbnVsbCkge1xuXHRcdFx0bG9hZFBhZ2UobG9jYXRpb24uaHJlZik7XG5cdFx0fVxuXHR9KTtcblxuXHQkKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiYSwgW2RhdGEtaHJlZl1cIiwgZnVuY3Rpb24oZXYpIHtcblx0XHR2YXIgaHJlZiA9ICQodGhpcykuYXR0cihcImhyZWZcIik7XG5cdFx0dmFyIGRhdGFBamF4ID0gJCh0aGlzKS5hdHRyKFwiZGF0YS1hamF4XCIpO1xuXG5cdFx0aWYgKGRhdGFBamF4ID09IFwiZmFsc2VcIiB8fCBocmVmID09IHVuZGVmaW5lZCB8fCBocmVmID09ICcjJykgeyByZXR1cm47IH1cblxuXHRcdGV2LnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRpZiAoaHJlZi5pbmRleE9mKGRvY3VtZW50LmRvbWFpbikgPiAtMSB8fCBocmVmLmluZGV4T2YoJzonKSA9PT0gLTEpIHtcblx0XHRcdC8vICRwcmVsb2FkZXIuc2hvdyggNTAwICk7XG5cdFx0XHRoaXN0b3J5LnB1c2hTdGF0ZSh7fSwgJycsIGhyZWYpO1xuXHRcdFx0bG9hZFBhZ2UoaHJlZik7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnNvbGUubG9nKCdbSU5GT10gQXQ6IGNsaWNrLmRhdGEtYWpheCcpO1xuXHRcdH1cblx0fSk7XG59KTtcbiIsIi8vIFJlZ2V4IHN1bW1hcnlcbi8vIC4gQW55IGNoYXJhY3RlciBleGNlcHQgbmV3bGluZS5cbi8vIFxcLiAgQSBwZXJpb2QgKGFuZCBzbyBvbiBmb3IgXFwqLCBcXCgsIFxcXFwsIGV0Yy4pXG4vLyBeIFRoZSBzdGFydCBvZiB0aGUgc3RyaW5nLlxuLy8gJCBUaGUgZW5kIG9mIHRoZSBzdHJpbmcuXG4vLyBcXGQsXFx3LFxccyAgQSBkaWdpdCwgd29yZCBjaGFyYWN0ZXIgW0EtWmEtejAtOV9dLCBvciB3aGl0ZXNwYWNlLlxuLy8gXFxELFxcVyxcXFMgIEFueXRoaW5nIGV4Y2VwdCBhIGRpZ2l0LCB3b3JkIGNoYXJhY3Rlciwgb3Igd2hpdGVzcGFjZS5cbi8vIFthYmNdIENoYXJhY3RlciBhLCBiLCBvciBjLlxuLy8gW2Etel0gYSB0aHJvdWdoIHouXG4vLyBbXmFiY10gIEFueSBjaGFyYWN0ZXIgZXhjZXB0IGEsIGIsIG9yIGMuXG4vLyBhYXxiYiBFaXRoZXIgYWEgb3IgYmIuXG4vLyA/IFplcm8gb3Igb25lIG9mIHRoZSBwcmVjZWRpbmcgZWxlbWVudC5cbi8vICogWmVybyBvciBtb3JlIG9mIHRoZSBwcmVjZWRpbmcgZWxlbWVudC5cbi8vICsgT25lIG9yIG1vcmUgb2YgdGhlIHByZWNlZGluZyBlbGVtZW50LlxuLy8ge259IEV4YWN0bHkgbiBvZiB0aGUgcHJlY2VkaW5nIGVsZW1lbnQuXG4vLyB7bix9ICBuIG9yIG1vcmUgb2YgdGhlIHByZWNlZGluZyBlbGVtZW50LlxuLy8ge20sbn0gQmV0d2VlbiBtIGFuZCBuIG9mIHRoZSBwcmVjZWRpbmcgZWxlbWVudC5cbi8vID8/LCo/LCs/LFxuLy8ge259PywgZXRjLiAgU2FtZSBhcyBhYm92ZSwgYnV0IGFzIGZldyBhcyBwb3NzaWJsZS5cbi8vIChleHByKSAgQ2FwdHVyZSBleHByIGZvciB1c2Ugd2l0aCBcXDEsIGV0Yy5cbi8vICg/OmV4cHIpICBOb24tY2FwdHVyaW5nIGdyb3VwLlxuLy8gKD89ZXhwcikgIEZvbGxvd2VkIGJ5IGV4cHIuXG4vLyAoPyFleHByKSAgTm90IGZvbGxvd2VkIGJ5IGV4cHIuXG5cbi8vIEZvdW5kYXRpb24gSmF2YVNjcmlwdFxuLy8gRG9jdW1lbnRhdGlvbiBjYW4gYmUgZm91bmQgYXQ6IGh0dHA6Ly9mb3VuZGF0aW9uLnp1cmIuY29tL2RvY3NcbiQoZG9jdW1lbnQpLmZvdW5kYXRpb24oe30pO1xuXG4vKiAgW0dMT0JBTF0gRnVuY3Rpb25zXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuICBcbiAgU3RyaW5nLnByb3RvdHlwZS5jYXBpdGFsaXplRmlyc3RMZXR0ZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdGhpcy5zbGljZSgxKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldFJhbmRvbUNvbG9yKCkge1xuICAgIHZhciBsZXR0ZXJzID0gJzAxMjM0NTY3ODlBQkNERUYnLnNwbGl0KCcnKTtcbiAgICB2YXIgY29sb3IgPSAnIyc7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCA2OyBpKysgKSB7XG4gICAgICBjb2xvciArPSBsZXR0ZXJzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDE2KV07XG4gICAgfVxuICAgIHJldHVybiBjb2xvcjtcbiAgfVxuXG4gIGZ1bmN0aW9uIGxvY2tfc2NyZWVuKCl7XG4gIH1cblxuICBmdW5jdGlvbiB1bmxvY2tfc2NyZWVuKCl7XG4gIH1cblxuICBmdW5jdGlvbiBjaGFpbl9vZl9ldmVudHMoZWwpe1xuICAgIGlmIChlbC5hdHRyKCdkYXRhLWV2ZW50cy1iZWZvcmUtcmVxdWVzdCcpKXtcbiAgICAgIHZhciBldmVudHMgPSBlbC5hdHRyKCdkYXRhLWV2ZW50cy1iZWZvcmUtcmVxdWVzdCcpLnNwbGl0KCcgJyk7XG5cbiAgICAgIGZvciAodmFyIGkgPSAwO2kgPCBldmVudHMubGVuZ3RoOyBpKyspe1xuICAgICAgICBlID0gZXZlbnRzW2ldLnRvU3RyaW5nKCk7XG4gICAgICAgIFxuICAgICAgICBzd2l0Y2goZSl7XG4gICAgICAgICAgY2FzZSAnYmVBY3RpdmUnOlxuICAgICAgICAgICAgJCgnYVtkYXRhLWV2ZW50c0JlZm9yZVJlcXVlc3Q9YmVBY3RpdmVdJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgZWwuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuXG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdmYWRlT3V0JzpcbiAgICAgICAgICAgIGVsLmZhZGVPdXQoKTtcblxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnYWRkRGF0YUluZGV4JzpcbiAgICAgICAgICAgIGVsID0gYWRkRGF0YUluZGV4KGVsKTtcblxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAncmVtb3ZlJzpcbiAgICAgICAgICAgIGlmIChldmVudHNbaSArIDFdKXtcbiAgICAgICAgICAgICAgJChldmVudHNbaSArIDFdKS5mYWRlT3V0KDEwMDAsIGZ1bmN0aW9uKCl7IFxuICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBlbC5mYWRlT3V0KDEwMDAsIGZ1bmN0aW9uKCl7IFxuICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGVsO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvY2Vzc19kYXRhKGRhdGEpe1xuICAgIGNvbnNvbGUubG9nKGRhdGEpXG4gICAgaWYgKGRhdGFbJ2FsZXJ0LXN1Y2Nlc3MnXSl7XG4gICAgICBhbGVydGlmeS5zdWNjZXNzKGRhdGFbJ2FsZXJ0LXN1Y2Nlc3MnXSk7XG4gICAgfSBcblxuICAgIGlmIChkYXRhWydhbGVydC1lcnJvciddKXtcbiAgICAgIGFsZXJ0aWZ5LmVycm9yKGRhdGFbJ2FsZXJ0LWVycm9yJ10pO1xuICAgIH1cblxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoZGF0YVsncmVkaXJlY3QnXSl7XG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZXBsYWNlKGRhdGFbJ3JlZGlyZWN0J10pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGRhdGFbJ2hyZWYnXSl7XG4gICAgICAgICAgZ2V0KGRhdGFbJ2hyZWYnXSk7ICAgICAgICBcbiAgICAgICAgfSBlbHNlIGlmIChkYXRhWyd0ZW1wbGF0ZSddKXtcbiAgICAgICAgICBpZihkYXRhWyd0YXJnZXQnXSl7XG4gICAgICAgICAgICAkKGRhdGFbJ3RhcmdldCddKS5odG1sKGRhdGFbJ3RlbXBsYXRlJ10pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICQoJyNwYWdlJykuaHRtbChkYXRhWyd0ZW1wbGF0ZSddKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBpZiAoZGF0YVsnYWxlcnQtc3VjY2VzcyddKXtcbiAgICAgICAgLy8gICBhbGVydGlmeS5zdWNjZXNzKGRhdGFbJ2FsZXJ0LXN1Y2Nlc3MnXSk7XG4gICAgICAgIC8vIH0gXG5cbiAgICAgICAgLy8gaWYgKGRhdGFbJ2FsZXJ0LWVycm9yJ10pe1xuICAgICAgICAvLyAgIGFsZXJ0aWZ5LmVycm9yKGRhdGFbJ2FsZXJ0LWVycm9yJ10pO1xuICAgICAgICAvLyB9XG4gICAgICB9XG4gICAgfSwgMTAwMCk7XG4gIH1cblxuICBmdW5jdGlvbiBiZWZvcmVfbG9hZCgpe1xuXG4gIH1cblxuICBmdW5jdGlvbiBnZXQodXJsLCBsb2NrKXtcbiAgICB2YXIgbG9jayA9ICh0eXBlb2YgbG9jayA9PT0gJ3VuZGVmaW5lZCcpID8gJ3RydWUnIDogbG9jaztcblxuICAgIGlmIChsb2NrID09ICd0cnVlJyl7XG4gICAgICBsb2NrX3NjcmVlbigpO1xuICAgIH1cblxuICAgICQuYWpheCh7XG4gICAgICB1cmwgICAgIDogdXJsLFxuICAgICAgdHlwZSAgICA6ICdnZXQnLFxuICAgICAgY2FjaGUgICA6IGZhbHNlLFxuICAgICAgc3VjY2VzcyA6IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICBwcm9jZXNzX2RhdGEoZGF0YSk7XG4gICAgICB9LFxuICAgICAgZXJyb3IgICA6IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICBhbGVydGlmeS5lcnJvcignRXJybyBkZXNjb25oZWNpZG8sIHBvciBmYXZvciBlbnRyYXIgZW0gY29udGF0byBjb20gb3MgYWRtaW5pc3RyYWRvcmVzIScpOyAgICAgXG4gICAgICB9LFxuICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICBiZWZvcmVfbG9hZCgpO1xuXG4gICAgICAgIGlmIChsb2NrID09ICd0cnVlJyl7XG4gICAgICAgICAgdW5sb2NrX3NjcmVlbigpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwb3N0KGZvcm0sIGxvY2spe1xuICAgIHZhciBsb2NrID0gKHR5cGVvZiBsb2NrID09PSAndW5kZWZpbmVkJykgPyAndHJ1ZScgOiBsb2NrOyAgIFxuICAgIFxuICAgIGlmIChsb2NrID09ICd0cnVlJyl7XG4gICAgICBsb2NrX3NjcmVlbigpOyBcbiAgICB9XG5cbiAgICBpZiAoZm9ybS5hdHRyKCdkYXRhLWN1c3RvbScpKXtcbiAgICAgIGlmICh0eXBlb2Ygd2luZG93W2Zvcm0uYXR0cignZGF0YS1jdXN0b20nKV0gPT09ICdmdW5jdGlvbicpe1xuICAgICAgICB2YXIgZGF0YSA9IHdpbmRvd1tmb3JtLmF0dHIoJ2RhdGEtY3VzdG9tJyldKGZvcm0pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgZGF0YSA9IGZvcm0uc2VyaWFsaXplKCk7XG4gICAgfVxuXG4gICAgdmFyIGNvbnRlbnQgPSAoZm9ybS5hdHRyKCdkYXRhLWNvbnRlbnQnKSA9PSAnZmFsc2UnKSA/IGZhbHNlIDogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDsgY2hhcnNldD1VVEYtOCc7XG4gICAgdmFyIHByb2Nlc3MgPSAoZm9ybS5hdHRyKCdkYXRhLXByb2Nlc3MnKSA9PSAnZmFsc2UnKSA/IGZhbHNlIDogdHJ1ZTsgXG5cbiAgICAkLmFqYXgoe1xuICAgICAgdXJsICAgICA6IGZvcm0uYXR0cignYWN0aW9uJyksXG4gICAgICB0eXBlICAgIDogZm9ybS5hdHRyKCdtZXRob2QnKSxcbiAgICAgIGRhdGEgICAgOiBkYXRhLFxuICAgICAgY2FjaGUgICA6IGZhbHNlLFxuICAgICAgY29udGVudFR5cGU6IGNvbnRlbnQsXG4gICAgICBwcm9jZXNzRGF0YTogcHJvY2VzcyxcbiAgICAgIHN1Y2Nlc3MgOiBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgcHJvY2Vzc19kYXRhKGRhdGEpO1xuICAgICAgfSxcbiAgICAgIGVycm9yICAgOiBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgYWxlcnRpZnkuZXJyb3IoJ0Vycm8gZGVzY29uaGVjaWRvLCBwb3IgZmF2b3IgZW50cmFyIGVtIGNvbnRhdG8gY29tIG9zIGFkbWluaXN0cmFkb3JlcyEnKTsgICAgXG4gICAgICB9LFxuICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICBiZWZvcmVfbG9hZCgpO1xuXG4gICAgICAgIGlmIChsb2NrID09ICd0cnVlJyl7XG4gICAgICAgICAgdW5sb2NrX3NjcmVlbigpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuLyogIFtHTE9CQUxdIENhbGxzXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG4gICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICdhW2RhdGEtZ2V0XScsIGZ1bmN0aW9uKGUpe1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgIGVsID0gJCh0aGlzKTtcblxuICAgIGlmICghZWwuaGFzQ2xhc3MoJ2FjdGl2ZScpKXtcblxuICAgICAgaWYgKGVsLmF0dHIoJ2RhdGEtY29uZmlybScpKXtcbiAgICAgICAgYWxlcnRpZnkuc2V0KHsgbGFiZWxzIDogeyBvazogXCJTaW1cIiwgY2FuY2VsOiBcIk7Dg8Kjb1wiIH0gfSk7XG4gICAgICAgIFxuICAgICAgICBhbGVydGlmeS5jb25maXJtKGVsLmF0dHIoJ2RhdGEtY29uZmlybScpLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICBlbCA9IGNoYWluX29mX2V2ZW50cyhlbCk7XG5cbiAgICAgICAgICAgIGdldChlbC5hdHRyKCdkYXRhLWdldCcpLCBlbC5hdHRyKCdkYXRhLWxvY2snKSk7IFxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhbGVydGlmeS5sb2coJ0HDg8Knw4PCo28gY2FuY2VsYWRhLicpXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVsID0gY2hhaW5fb2ZfZXZlbnRzKGVsKTtcblxuICAgICAgICBnZXQoZWwuYXR0cignZGF0YS1nZXQnKSwgZWwuYXR0cignZGF0YS1sb2NrJykpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJ1tkYXRhLXN1Ym1pdF0nLCBmdW5jdGlvbihlKXtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICB2YXIgZWwgPSAkKHRoaXMpO1xuICAgIHZhciBmb3JtID0gZWwuY2xvc2VzdCgnZm9ybScpO1xuICAgIHZhciBmb3JtX3ZhbGlkID0gdHJ1ZTtcbiAgICB2YXIgcmVxdWlyZWRfZmllbGRzID0gZm9ybS5maW5kKCdbZGF0YS1yZXF1aXJlZF0nKTtcblxuICAgIHJlcXVpcmVkX2ZpZWxkcy5lYWNoKGZ1bmN0aW9uKGluZGV4KXtcbiAgICAgIHZhciBmaWVsZCA9ICQodGhpcyk7XG4gICAgICB2YXIgZXJyb3JfbXNnID0gZmllbGQuYXR0cignZGF0YS1yZXF1aXJlZCcpO1xuXG4gICAgICBpZiAoZmllbGQudmFsKCkgPT0gJycgfHwgZmllbGQudmFsKCkgPT0gMCl7XG4gICAgICAgIGZpZWxkLmFkZENsYXNzKCdpbnZhbGlkJyk7XG4gICAgICAgIGFsZXJ0aWZ5LmVycm9yKGVycm9yX21zZyk7XG4gICAgICAgIGZvcm1fdmFsaWQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgICBpZiAoZm9ybS5hdHRyKCdkYXRhLWRlZmF1bHQnKSl7XG4gICAgICBmb3JtLnN1Ym1pdCgpO1xuICAgIH0gZWxzZSBpZiAoZm9ybV92YWxpZCl7XG4gICAgICBwb3N0KGZvcm0sIGZvcm0uYXR0cignZGF0YS1sb2NrJykpO1xuICAgIH0gXG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH0pXG5cbiAgJChkb2N1bWVudCkub24oJ3N1Ym1pdCcsICdmb3JtJywgZnVuY3Rpb24oKXtcbiAgICB2YXIgZWwgPSAkKHRoaXMpO1xuICAgIHZhciBmb3JtX3ZhbGlkID0gdHJ1ZTtcbiAgICB2YXIgcmVxdWlyZWRfZmllbGRzID0gZWwuZmluZCgnW2RhdGEtcmVxdWlyZWRdJyk7XG5cbiAgICByZXF1aXJlZF9maWVsZHMuZWFjaChmdW5jdGlvbihpbmRleCl7XG4gICAgICB2YXIgZmllbGQgPSAkKHRoaXMpO1xuICAgICAgdmFyIGVycm9yX21zZyA9IGZpZWxkLmF0dHIoJ2RhdGEtcmVxdWlyZWQnKTtcblxuICAgICAgaWYgKGZpZWxkLnZhbCgpID09ICcnIHx8IGZpZWxkLnZhbCgpID09IDApe1xuICAgICAgICBmaWVsZC5hZGRDbGFzcygnaW52YWxpZCcpO1xuICAgICAgICBhbGVydGlmeS5lcnJvcihlcnJvcl9tc2cpO1xuICAgICAgICBmb3JtX3ZhbGlkID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSk7XG4gICAgXG4gICAgaWYgKGVsLmF0dHIoJ2RhdGEtZGVmYXVsdCcpKXtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSBpZiAoZm9ybV92YWxpZCl7XG4gICAgICBwb3N0KGVsLCBlbC5hdHRyKCdkYXRhLWxvY2snKSk7XG4gICAgfSBcblxuICAgIHJldHVybiBmYWxzZTtcbiAgfSk7XG5cbiAgJCgnI3Zpc2liaWxpdHknKS5jaGFuZ2UoZnVuY3Rpb24oKXtcbiAgICAgICBjYiA9ICQodGhpcyk7XG4gICAgICAgY2IudmFsKGNiLnByb3AoJ2NoZWNrZWQnKS50b1N0cmluZygpLmNhcGl0YWxpemVGaXJzdExldHRlcigpKTtcbiAgIH0pOyAgXG5cbiAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXtcbiAgICAkKCcjcGFnZScpLmNzcygnbWluLWhlaWdodCcsICQoJ2JvZHknKS5oZWlnaHQoKSAtIDEwMCk7XG5cbiAgICAkKCcucHJvamVjdC1ib3gnKS5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAvLyAkKHRoaXMpLmNzcygnYmFja2dyb3VuZC1jb2xvcicsIGdldFJhbmRvbUNvbG9yKCkpO1xuICAgIH0pO1xuXG4gICAgJCgnLmRhdGVwaWNrZXInKS5waWNrYWRhdGUoe1xuICAgICAgICBmb3JtYXRTdWJtaXQ6ICd5eXl5L21tL2RkJyxcbiAgICB9KTtcbiAgfSk7XG5cbiAgJCggd2luZG93ICkucmVzaXplKGZ1bmN0aW9uKCkge1xuICAgICQoJyNwYWdlJykuY3NzKCdtaW4taGVpZ2h0JywgJCgnYm9keScpLmhlaWdodCgpIC0gMTAwKTtcbiAgfSk7XG5cbiAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5oZXJvX19tZXRhLWFuY2hvci1sb2dpbicsIGZ1bmN0aW9uKCkge1xuICAgICQoJy5oZXJvX19mb3Jtcy1sb2dpbiBmb3JtJykuc3RvcCgpLmFuaW1hdGUoe1xuICAgICAgICB3aWR0aDogXCIxMDAlXCIsXG4gICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICB9LCAxMDAwKTtcbiAgICAkKCcuaGVyb19fZm9ybXMtc2lnbnVwIGZvcm0nKS5zdG9wKCkuYW5pbWF0ZSh7XG4gICAgICAgIHdpZHRoOiBcIjBcIixcbiAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgIH0sIDEwMDApO1xuICB9KTtcbiAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5oZXJvX19tZXRhLWFuY2hvci1zaWdudXAnLCBmdW5jdGlvbigpIHtcbiAgICAkKCcuaGVyb19fZm9ybXMtc2lnbnVwIGZvcm0nKS5zdG9wKCkuYW5pbWF0ZSh7XG4gICAgICAgIHdpZHRoOiBcIjEwMCVcIixcbiAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgIH0sIDEwMDApO1xuICAgICQoJy5oZXJvX19mb3Jtcy1sb2dpbiBmb3JtJykuc3RvcCgpLmFuaW1hdGUoe1xuICAgICAgICB3aWR0aDogXCIwXCIsXG4gICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICB9LCAxMDAwKTtcbiAgfSk7IiwiIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9