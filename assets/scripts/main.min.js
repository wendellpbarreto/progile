$(function() {
	String.prototype.decodeHTML = function() { return $("<div>", {html: "" + this}).html(); };

	var $page = $("#page"), $preloader = $("#preloader"), $counter = 0;

	checkUrl = function(slug) {
		var url = location.href;
		var regex = '^(http[s]?\:\/\/){0,1}(www\.){0,1}[a-zA-Z0-9\.\-\_\:]+(\/)?' + slug + '(\#)?(\/)?$';
		if (url.match(new RegExp(regex))) { return true; } else { return false; };
	},

	engineSideMenu = function() {

	},

	engineFormValidations = function() {
	},

	engineGraphs = function(graph, resource, title) {

	},

	enginePage = function() {

		if (checkUrl("simulated_tests/new")) {
			console.log('[INFO] enginePage called at: simulated_tests/new.');

			var engineDatepickers = function() {
				$('#page .input-group.date').datepicker({
					todayBtn: "linked",
					keyboardNavigation: false,
					forceParse: false,
					calendarWeeks: true,
					autoclose: true,
					format: 'dd/mm/yyyy',
				});
			}

			var engineSelects = function() {
				$('#page .chosen-select').chosen({width: 'inherit'});
			}

			var engineIChecks = function() {
				$('#page .i-checks').iCheck({
					checkboxClass: 'icheckbox_square-green',
					radioClass: 'iradio_square-green',
				});
			}

			engineDatepickers();
			engineIChecks();
			engineSelects();

			$('#dates').on('cocoon:after-insert', function() {
				console.log("dasd")
				engineDatepickers();
			});

			$('#questions').on('cocoon:after-insert', function() {
				engineSelects();
				engineIChecks();
			});

			$('.add-question').trigger('click');
		} else {
					console.log('[INFO] enginePage called at generic page.');

					if ($('table#dashboard-simulated-test-graph-resource').length > 0) {
						var resource = $('table#dashboard-simulated-test-graph-resource tr').get().map(function(row) {
							return $(row).find('td').get().map(function(cell) {
								return $(cell).html();
							});
						});

						categories = [];
						for (i = 2; i < resource.length; ++i) {
							categories.push(resource[i][0]);
						}
						data = [];
						for (j = 1; j < resource[0].length; ++j) {
							data[j-1] = {};
							data[j-1]["data"] = [];
							data[j-1]["name"] = resource[0][j];
							data[j-1]["color"] = resource[1][j];

							for (k = 2; k < resource.length; ++k) {
								data[j-1]["data"].push(parseFloat(resource[k][j]));
							}
						}

						$('#dashboard-simulated-test-graph').highcharts({
							chart: {
								type: 'column',
								height: 220,
							},
							title: { text: ' '  },
							legend: {
								layout: 'horizontal',
								align: 'center',
								verticalAlign: 'top',
							},
							credits: false,
							xAxis: {
								categories: categories,
								crosshair: true
							},
							yAxis: {
								min: 0,
								max: 100,
								tickInterval: 20,
								title: {
									text: 'Porcentagem de acertos'
								}
							},
							tooltip: {
								headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
								pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
								'<td style="padding:0"><b>{point.y:.1f} %</b></td></tr>',
								footerFormat: '</table>',
								shared: true,
								useHTML: true
							},
							plotOptions: {
								column: {
									pointPadding: 0.2,
									borderWidth: 0
								}
							},
							series: data
						});
					}

					if ($('#flot-chart1').length > 0) {
						var d1 = [[1262304000000, 6], [1264982400000, 3057], [1267401600000, 20434], [1270080000000, 31982], [1272672000000, 26602], [1275350400000, 27826], [1277942400000, 24302], [1280620800000, 24237], [1283299200000, 21004], [1285891200000, 12144], [1288569600000, 10577], [1291161600000, 10295]];
						var d2 = [[1262304000000, 5], [1264982400000, 200], [1267401600000, 1605], [1270080000000, 6129], [1272672000000, 11643], [1275350400000, 19055], [1277942400000, 30062], [1280620800000, 39197], [1283299200000, 37000], [1285891200000, 27000], [1288569600000, 21000], [1291161600000, 17000]];

						var data1 = [
						{ label: "Data 1", data: d1, color: '#17a084'},
						{ label: "Data 2", data: d2, color: '#127e68' }
						];
						$.plot($("#flot-chart1"), data1, {
							xaxis: {
								tickDecimals: 0
							},
							series: {
								lines: {
									show: true,
									fill: true,
									fillColor: {
										colors: [{
											opacity: 1
										}, {
											opacity: 1
										}]
									},
								},
								points: {
									width: 0.1,
									show: false
								},
							},
							grid: {
								show: false,
								borderWidth: 0
							},
							legend: {
								show: false,
							}
						});
					}
		}
	},

	init = function() {
		engineSideMenu();
		enginePage();
		engineFormValidations();
	},

	ajaxLoad = function(html, status, xhr) {
		$counter++;
		console.log("- -- --- ---- ----- " + $counter + "ยบ ajax call ----- ---- --- -- -");
		console.log("[INFO] Ajax Request Status: " + status);
		console.log("[INFO] Ajax Request XHR: " + xhr);
		if ( status == "error" ) {
			var msg = "Sorry but there was an error: ";
			alert(msg + xhr.status + " " + xhr.statusText);
		} else {
			// $preloader.hide( 500 );
			document.title = html
			.match(/<title>(.*?)<\/title>/)[1]
			.trim()
			.decodeHTML();
			init();
		}
	},

	loadPage = function(href) {
		$page.load(href + ' #page>*', ajaxLoad);
	};

	init();

	$(window).on("popstate", function(e) {
		if (e.originalEvent.state !== null) {
			loadPage(location.href);
		}
	});

	$(document).on("click", "a, [data-href]", function(ev) {
		var href = $(this).attr("href");
		var dataAjax = $(this).attr("data-ajax");

		if (dataAjax == "false" || href == undefined || href == '#') { return; }

		ev.preventDefault();

		if (href.indexOf(document.domain) > -1 || href.indexOf(':') === -1) {
			// $preloader.show( 500 );
			history.pushState({}, '', href);
			loadPage(href);
			return false;
		} else {
			console.log('[INFO] At: click.data-ajax');
		}
	});
});

// Regex summary
// . Any character except newline.
// \.  A period (and so on for \*, \(, \\, etc.)
// ^ The start of the string.
// $ The end of the string.
// \d,\w,\s  A digit, word character [A-Za-z0-9_], or whitespace.
// \D,\W,\S  Anything except a digit, word character, or whitespace.
// [abc] Character a, b, or c.
// [a-z] a through z.
// [^abc]  Any character except a, b, or c.
// aa|bb Either aa or bb.
// ? Zero or one of the preceding element.
// * Zero or more of the preceding element.
// + One or more of the preceding element.
// {n} Exactly n of the preceding element.
// {n,}  n or more of the preceding element.
// {m,n} Between m and n of the preceding element.
// ??,*?,+?,
// {n}?, etc.  Same as above, but as few as possible.
// (expr)  Capture expr for use with \1, etc.
// (?:expr)  Non-capturing group.
// (?=expr)  Followed by expr.
// (?!expr)  Not followed by expr.

// Foundation JavaScript
// Documentation can be found at: http://foundation.zurb.com/docs
$(document).foundation({
 
});

/*  [GLOBAL] Functions
*******************************************************************/
  
  String.prototype.capitalizeFirstLetter = function() {
      return this.charAt(0).toUpperCase() + this.slice(1);
  }

  function lock_screen(){
  }

  function unlock_screen(){
  }

  function chain_of_events(el){
    if (el.attr('data-events-before-request')){
      var events = el.attr('data-events-before-request').split(' ');

      for (var i = 0;i < events.length; i++){
        e = events[i].toString();
        
        switch(e){
          case 'beActive':
            $('a[data-eventsBeforeRequest=beActive]').removeClass('active');
            el.addClass('active');

            break;
          case 'fadeOut':
            el.fadeOut();

            break;
          case 'addDataIndex':
            el = addDataIndex(el);

            break;
          case 'remove':
            if (events[i + 1]){
              $(events[i + 1]).fadeOut(1000, function(){ 
                $(this).remove();
              })
            } else {
              el.fadeOut(1000, function(){ 
                $(this).remove();
              })
            }
          default:
            break;
        }
      }
    }

    return el;
  }

  function process_data(data){
    console.log(data)
    if (data['alert-success']){
      alertify.success(data['alert-success']);
    } 

    if (data['alert-error']){
      alertify.error(data['alert-error']);
    }

    setTimeout(function() {
      if (data['redirect']){
        window.location.replace(data['redirect']);
      } else {
        if (data['href']){
          get(data['href']);        
        } else if (data['template']){
          if(data['target']){
            $(data['target']).html(data['template']);
          } else {
           $('#page').html(data['template']);
          }
        }

        // if (data['alert-success']){
        //   alertify.success(data['alert-success']);
        // } 

        // if (data['alert-error']){
        //   alertify.error(data['alert-error']);
        // }
      }
    }, 1000);
  }

  function before_load(){

  }

  function get(url, lock){
    var lock = (typeof lock === 'undefined') ? 'true' : lock;

    if (lock == 'true'){
      lock_screen();
    }

    $.ajax({
      url     : url,
      type    : 'get',
      cache   : false,
      success : function(data){
        process_data(data);
      },
      error   : function(data){
        alertify.error('Erro desconhecido, por favor entrar em contato com os administradores!');     
      },
      complete: function(data){
        before_load();

        if (lock == 'true'){
          unlock_screen();
        }
      }
    });
  }

  function post(form, lock){
    var lock = (typeof lock === 'undefined') ? 'true' : lock;   
    
    if (lock == 'true'){
      lock_screen(); 
    }

    if (form.attr('data-custom')){
      if (typeof window[form.attr('data-custom')] === 'function'){
        var data = window[form.attr('data-custom')](form);
      }
    } else {
      var data = form.serialize();
    }

    var content = (form.attr('data-content') == 'false') ? false : 'application/x-www-form-urlencoded; charset=UTF-8';
    var process = (form.attr('data-process') == 'false') ? false : true; 

    $.ajax({
      url     : form.attr('action'),
      type    : form.attr('method'),
      data    : data,
      cache   : false,
      contentType: content,
      processData: process,
      success : function(data){
        process_data(data);
      },
      error   : function(data){
        alertify.error('Erro desconhecido, por favor entrar em contato com os administradores!');    
      },
      complete: function(data){
        before_load();

        if (lock == 'true'){
          unlock_screen();
        }
      }
    });
  }

/*  [GLOBAL] Calls
*******************************************************************/

  $(document).on('click', 'a[data-get]', function(e){
    e.preventDefault();

    el = $(this);

    if (!el.hasClass('active')){

      if (el.attr('data-confirm')){
        alertify.set({ labels : { ok: "Sim", cancel: "Nรยฃo" } });
        
        alertify.confirm(el.attr('data-confirm'), function (e) {
          if (e) {
            el = chain_of_events(el);

            get(el.attr('data-get'), el.attr('data-lock')); 
          } else {
            alertify.log('Aรยงรยฃo cancelada.')
          }
        });
      } else {
        el = chain_of_events(el);

        get(el.attr('data-get'), el.attr('data-lock'));
      }
    }
  });

  $(document).on('click', '[data-submit]', function(e){
    e.preventDefault();

    var el = $(this);
    var form = el.closest('form');
    var form_valid = true;
    var required_fields = form.find('[data-required]');

    required_fields.each(function(index){
      var field = $(this);
      var error_msg = field.attr('data-required');

      if (field.val() == '' || field.val() == 0){
        field.addClass('invalid');
        alertify.error(error_msg);
        form_valid = false;
      }
    });
    
    if (form.attr('data-default')){
      form.submit();
    } else if (form_valid){
      post(form, form.attr('data-lock'));
    } 

    return false;
  })

  $(document).on('submit', 'form', function(){
    var el = $(this);
    var form_valid = true;
    var required_fields = el.find('[data-required]');

    required_fields.each(function(index){
      var field = $(this);
      var error_msg = field.attr('data-required');

      if (field.val() == '' || field.val() == 0){
        field.addClass('invalid');
        alertify.error(error_msg);
        form_valid = false;
      }
    });
    
    if (el.attr('data-default')){
      return true;
    } else if (form_valid){
      post(el, el.attr('data-lock'));
    } 

    return false;
  });
  $('#visibility').change(function(){
       cb = $(this);
       cb.val(cb.prop('checked').toString().capitalizeFirstLetter());
   });  
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFqYXhSZXF1ZXN0cy5qcyIsIm1haW4uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbk9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIiQoZnVuY3Rpb24oKSB7XG5cdFN0cmluZy5wcm90b3R5cGUuZGVjb2RlSFRNTCA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gJChcIjxkaXY+XCIsIHtodG1sOiBcIlwiICsgdGhpc30pLmh0bWwoKTsgfTtcblxuXHR2YXIgJHBhZ2UgPSAkKFwiI3BhZ2VcIiksICRwcmVsb2FkZXIgPSAkKFwiI3ByZWxvYWRlclwiKSwgJGNvdW50ZXIgPSAwO1xuXG5cdGNoZWNrVXJsID0gZnVuY3Rpb24oc2x1Zykge1xuXHRcdHZhciB1cmwgPSBsb2NhdGlvbi5ocmVmO1xuXHRcdHZhciByZWdleCA9ICdeKGh0dHBbc10/XFw6XFwvXFwvKXswLDF9KHd3d1xcLil7MCwxfVthLXpBLVowLTlcXC5cXC1cXF9cXDpdKyhcXC8pPycgKyBzbHVnICsgJyhcXCMpPyhcXC8pPyQnO1xuXHRcdGlmICh1cmwubWF0Y2gobmV3IFJlZ0V4cChyZWdleCkpKSB7IHJldHVybiB0cnVlOyB9IGVsc2UgeyByZXR1cm4gZmFsc2U7IH07XG5cdH0sXG5cblx0ZW5naW5lU2lkZU1lbnUgPSBmdW5jdGlvbigpIHtcblxuXHR9LFxuXG5cdGVuZ2luZUZvcm1WYWxpZGF0aW9ucyA9IGZ1bmN0aW9uKCkge1xuXHR9LFxuXG5cdGVuZ2luZUdyYXBocyA9IGZ1bmN0aW9uKGdyYXBoLCByZXNvdXJjZSwgdGl0bGUpIHtcblxuXHR9LFxuXG5cdGVuZ2luZVBhZ2UgPSBmdW5jdGlvbigpIHtcblxuXHRcdGlmIChjaGVja1VybChcInNpbXVsYXRlZF90ZXN0cy9uZXdcIikpIHtcblx0XHRcdGNvbnNvbGUubG9nKCdbSU5GT10gZW5naW5lUGFnZSBjYWxsZWQgYXQ6IHNpbXVsYXRlZF90ZXN0cy9uZXcuJyk7XG5cblx0XHRcdHZhciBlbmdpbmVEYXRlcGlja2VycyA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHQkKCcjcGFnZSAuaW5wdXQtZ3JvdXAuZGF0ZScpLmRhdGVwaWNrZXIoe1xuXHRcdFx0XHRcdHRvZGF5QnRuOiBcImxpbmtlZFwiLFxuXHRcdFx0XHRcdGtleWJvYXJkTmF2aWdhdGlvbjogZmFsc2UsXG5cdFx0XHRcdFx0Zm9yY2VQYXJzZTogZmFsc2UsXG5cdFx0XHRcdFx0Y2FsZW5kYXJXZWVrczogdHJ1ZSxcblx0XHRcdFx0XHRhdXRvY2xvc2U6IHRydWUsXG5cdFx0XHRcdFx0Zm9ybWF0OiAnZGQvbW0veXl5eScsXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgZW5naW5lU2VsZWN0cyA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHQkKCcjcGFnZSAuY2hvc2VuLXNlbGVjdCcpLmNob3Nlbih7d2lkdGg6ICdpbmhlcml0J30pO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgZW5naW5lSUNoZWNrcyA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHQkKCcjcGFnZSAuaS1jaGVja3MnKS5pQ2hlY2soe1xuXHRcdFx0XHRcdGNoZWNrYm94Q2xhc3M6ICdpY2hlY2tib3hfc3F1YXJlLWdyZWVuJyxcblx0XHRcdFx0XHRyYWRpb0NsYXNzOiAnaXJhZGlvX3NxdWFyZS1ncmVlbicsXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRlbmdpbmVEYXRlcGlja2VycygpO1xuXHRcdFx0ZW5naW5lSUNoZWNrcygpO1xuXHRcdFx0ZW5naW5lU2VsZWN0cygpO1xuXG5cdFx0XHQkKCcjZGF0ZXMnKS5vbignY29jb29uOmFmdGVyLWluc2VydCcsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRjb25zb2xlLmxvZyhcImRhc2RcIilcblx0XHRcdFx0ZW5naW5lRGF0ZXBpY2tlcnMoKTtcblx0XHRcdH0pO1xuXG5cdFx0XHQkKCcjcXVlc3Rpb25zJykub24oJ2NvY29vbjphZnRlci1pbnNlcnQnLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0ZW5naW5lU2VsZWN0cygpO1xuXHRcdFx0XHRlbmdpbmVJQ2hlY2tzKCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0JCgnLmFkZC1xdWVzdGlvbicpLnRyaWdnZXIoJ2NsaWNrJyk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb25zb2xlLmxvZygnW0lORk9dIGVuZ2luZVBhZ2UgY2FsbGVkIGF0IGdlbmVyaWMgcGFnZS4nKTtcblxuXHRcdFx0XHRcdGlmICgkKCd0YWJsZSNkYXNoYm9hcmQtc2ltdWxhdGVkLXRlc3QtZ3JhcGgtcmVzb3VyY2UnKS5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdFx0XHR2YXIgcmVzb3VyY2UgPSAkKCd0YWJsZSNkYXNoYm9hcmQtc2ltdWxhdGVkLXRlc3QtZ3JhcGgtcmVzb3VyY2UgdHInKS5nZXQoKS5tYXAoZnVuY3Rpb24ocm93KSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiAkKHJvdykuZmluZCgndGQnKS5nZXQoKS5tYXAoZnVuY3Rpb24oY2VsbCkge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiAkKGNlbGwpLmh0bWwoKTtcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0Y2F0ZWdvcmllcyA9IFtdO1xuXHRcdFx0XHRcdFx0Zm9yIChpID0gMjsgaSA8IHJlc291cmNlLmxlbmd0aDsgKytpKSB7XG5cdFx0XHRcdFx0XHRcdGNhdGVnb3JpZXMucHVzaChyZXNvdXJjZVtpXVswXSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRkYXRhID0gW107XG5cdFx0XHRcdFx0XHRmb3IgKGogPSAxOyBqIDwgcmVzb3VyY2VbMF0ubGVuZ3RoOyArK2opIHtcblx0XHRcdFx0XHRcdFx0ZGF0YVtqLTFdID0ge307XG5cdFx0XHRcdFx0XHRcdGRhdGFbai0xXVtcImRhdGFcIl0gPSBbXTtcblx0XHRcdFx0XHRcdFx0ZGF0YVtqLTFdW1wibmFtZVwiXSA9IHJlc291cmNlWzBdW2pdO1xuXHRcdFx0XHRcdFx0XHRkYXRhW2otMV1bXCJjb2xvclwiXSA9IHJlc291cmNlWzFdW2pdO1xuXG5cdFx0XHRcdFx0XHRcdGZvciAoayA9IDI7IGsgPCByZXNvdXJjZS5sZW5ndGg7ICsraykge1xuXHRcdFx0XHRcdFx0XHRcdGRhdGFbai0xXVtcImRhdGFcIl0ucHVzaChwYXJzZUZsb2F0KHJlc291cmNlW2tdW2pdKSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0JCgnI2Rhc2hib2FyZC1zaW11bGF0ZWQtdGVzdC1ncmFwaCcpLmhpZ2hjaGFydHMoe1xuXHRcdFx0XHRcdFx0XHRjaGFydDoge1xuXHRcdFx0XHRcdFx0XHRcdHR5cGU6ICdjb2x1bW4nLFxuXHRcdFx0XHRcdFx0XHRcdGhlaWdodDogMjIwLFxuXHRcdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0XHR0aXRsZTogeyB0ZXh0OiAnICcgIH0sXG5cdFx0XHRcdFx0XHRcdGxlZ2VuZDoge1xuXHRcdFx0XHRcdFx0XHRcdGxheW91dDogJ2hvcml6b250YWwnLFxuXHRcdFx0XHRcdFx0XHRcdGFsaWduOiAnY2VudGVyJyxcblx0XHRcdFx0XHRcdFx0XHR2ZXJ0aWNhbEFsaWduOiAndG9wJyxcblx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0Y3JlZGl0czogZmFsc2UsXG5cdFx0XHRcdFx0XHRcdHhBeGlzOiB7XG5cdFx0XHRcdFx0XHRcdFx0Y2F0ZWdvcmllczogY2F0ZWdvcmllcyxcblx0XHRcdFx0XHRcdFx0XHRjcm9zc2hhaXI6IHRydWVcblx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0eUF4aXM6IHtcblx0XHRcdFx0XHRcdFx0XHRtaW46IDAsXG5cdFx0XHRcdFx0XHRcdFx0bWF4OiAxMDAsXG5cdFx0XHRcdFx0XHRcdFx0dGlja0ludGVydmFsOiAyMCxcblx0XHRcdFx0XHRcdFx0XHR0aXRsZToge1xuXHRcdFx0XHRcdFx0XHRcdFx0dGV4dDogJ1BvcmNlbnRhZ2VtIGRlIGFjZXJ0b3MnXG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0XHR0b29sdGlwOiB7XG5cdFx0XHRcdFx0XHRcdFx0aGVhZGVyRm9ybWF0OiAnPHNwYW4gc3R5bGU9XCJmb250LXNpemU6MTBweFwiPntwb2ludC5rZXl9PC9zcGFuPjx0YWJsZT4nLFxuXHRcdFx0XHRcdFx0XHRcdHBvaW50Rm9ybWF0OiAnPHRyPjx0ZCBzdHlsZT1cImNvbG9yOntzZXJpZXMuY29sb3J9O3BhZGRpbmc6MFwiPntzZXJpZXMubmFtZX06IDwvdGQ+JyArXG5cdFx0XHRcdFx0XHRcdFx0Jzx0ZCBzdHlsZT1cInBhZGRpbmc6MFwiPjxiPntwb2ludC55Oi4xZn0gJTwvYj48L3RkPjwvdHI+Jyxcblx0XHRcdFx0XHRcdFx0XHRmb290ZXJGb3JtYXQ6ICc8L3RhYmxlPicsXG5cdFx0XHRcdFx0XHRcdFx0c2hhcmVkOiB0cnVlLFxuXHRcdFx0XHRcdFx0XHRcdHVzZUhUTUw6IHRydWVcblx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0cGxvdE9wdGlvbnM6IHtcblx0XHRcdFx0XHRcdFx0XHRjb2x1bW46IHtcblx0XHRcdFx0XHRcdFx0XHRcdHBvaW50UGFkZGluZzogMC4yLFxuXHRcdFx0XHRcdFx0XHRcdFx0Ym9yZGVyV2lkdGg6IDBcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHRcdHNlcmllczogZGF0YVxuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCQoJyNmbG90LWNoYXJ0MScpLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0XHRcdHZhciBkMSA9IFtbMTI2MjMwNDAwMDAwMCwgNl0sIFsxMjY0OTgyNDAwMDAwLCAzMDU3XSwgWzEyNjc0MDE2MDAwMDAsIDIwNDM0XSwgWzEyNzAwODAwMDAwMDAsIDMxOTgyXSwgWzEyNzI2NzIwMDAwMDAsIDI2NjAyXSwgWzEyNzUzNTA0MDAwMDAsIDI3ODI2XSwgWzEyNzc5NDI0MDAwMDAsIDI0MzAyXSwgWzEyODA2MjA4MDAwMDAsIDI0MjM3XSwgWzEyODMyOTkyMDAwMDAsIDIxMDA0XSwgWzEyODU4OTEyMDAwMDAsIDEyMTQ0XSwgWzEyODg1Njk2MDAwMDAsIDEwNTc3XSwgWzEyOTExNjE2MDAwMDAsIDEwMjk1XV07XG5cdFx0XHRcdFx0XHR2YXIgZDIgPSBbWzEyNjIzMDQwMDAwMDAsIDVdLCBbMTI2NDk4MjQwMDAwMCwgMjAwXSwgWzEyNjc0MDE2MDAwMDAsIDE2MDVdLCBbMTI3MDA4MDAwMDAwMCwgNjEyOV0sIFsxMjcyNjcyMDAwMDAwLCAxMTY0M10sIFsxMjc1MzUwNDAwMDAwLCAxOTA1NV0sIFsxMjc3OTQyNDAwMDAwLCAzMDA2Ml0sIFsxMjgwNjIwODAwMDAwLCAzOTE5N10sIFsxMjgzMjk5MjAwMDAwLCAzNzAwMF0sIFsxMjg1ODkxMjAwMDAwLCAyNzAwMF0sIFsxMjg4NTY5NjAwMDAwLCAyMTAwMF0sIFsxMjkxMTYxNjAwMDAwLCAxNzAwMF1dO1xuXG5cdFx0XHRcdFx0XHR2YXIgZGF0YTEgPSBbXG5cdFx0XHRcdFx0XHR7IGxhYmVsOiBcIkRhdGEgMVwiLCBkYXRhOiBkMSwgY29sb3I6ICcjMTdhMDg0J30sXG5cdFx0XHRcdFx0XHR7IGxhYmVsOiBcIkRhdGEgMlwiLCBkYXRhOiBkMiwgY29sb3I6ICcjMTI3ZTY4JyB9XG5cdFx0XHRcdFx0XHRdO1xuXHRcdFx0XHRcdFx0JC5wbG90KCQoXCIjZmxvdC1jaGFydDFcIiksIGRhdGExLCB7XG5cdFx0XHRcdFx0XHRcdHhheGlzOiB7XG5cdFx0XHRcdFx0XHRcdFx0dGlja0RlY2ltYWxzOiAwXG5cdFx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHRcdHNlcmllczoge1xuXHRcdFx0XHRcdFx0XHRcdGxpbmVzOiB7XG5cdFx0XHRcdFx0XHRcdFx0XHRzaG93OiB0cnVlLFxuXHRcdFx0XHRcdFx0XHRcdFx0ZmlsbDogdHJ1ZSxcblx0XHRcdFx0XHRcdFx0XHRcdGZpbGxDb2xvcjoge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRjb2xvcnM6IFt7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0b3BhY2l0eTogMVxuXHRcdFx0XHRcdFx0XHRcdFx0XHR9LCB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0b3BhY2l0eTogMVxuXHRcdFx0XHRcdFx0XHRcdFx0XHR9XVxuXHRcdFx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0XHRcdHBvaW50czoge1xuXHRcdFx0XHRcdFx0XHRcdFx0d2lkdGg6IDAuMSxcblx0XHRcdFx0XHRcdFx0XHRcdHNob3c6IGZhbHNlXG5cdFx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0Z3JpZDoge1xuXHRcdFx0XHRcdFx0XHRcdHNob3c6IGZhbHNlLFxuXHRcdFx0XHRcdFx0XHRcdGJvcmRlcldpZHRoOiAwXG5cdFx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHRcdGxlZ2VuZDoge1xuXHRcdFx0XHRcdFx0XHRcdHNob3c6IGZhbHNlLFxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cdFx0fVxuXHR9LFxuXG5cdGluaXQgPSBmdW5jdGlvbigpIHtcblx0XHRlbmdpbmVTaWRlTWVudSgpO1xuXHRcdGVuZ2luZVBhZ2UoKTtcblx0XHRlbmdpbmVGb3JtVmFsaWRhdGlvbnMoKTtcblx0fSxcblxuXHRhamF4TG9hZCA9IGZ1bmN0aW9uKGh0bWwsIHN0YXR1cywgeGhyKSB7XG5cdFx0JGNvdW50ZXIrKztcblx0XHRjb25zb2xlLmxvZyhcIi0gLS0gLS0tIC0tLS0gLS0tLS0gXCIgKyAkY291bnRlciArIFwiwrogYWpheCBjYWxsIC0tLS0tIC0tLS0gLS0tIC0tIC1cIik7XG5cdFx0Y29uc29sZS5sb2coXCJbSU5GT10gQWpheCBSZXF1ZXN0IFN0YXR1czogXCIgKyBzdGF0dXMpO1xuXHRcdGNvbnNvbGUubG9nKFwiW0lORk9dIEFqYXggUmVxdWVzdCBYSFI6IFwiICsgeGhyKTtcblx0XHRpZiAoIHN0YXR1cyA9PSBcImVycm9yXCIgKSB7XG5cdFx0XHR2YXIgbXNnID0gXCJTb3JyeSBidXQgdGhlcmUgd2FzIGFuIGVycm9yOiBcIjtcblx0XHRcdGFsZXJ0KG1zZyArIHhoci5zdGF0dXMgKyBcIiBcIiArIHhoci5zdGF0dXNUZXh0KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Ly8gJHByZWxvYWRlci5oaWRlKCA1MDAgKTtcblx0XHRcdGRvY3VtZW50LnRpdGxlID0gaHRtbFxuXHRcdFx0Lm1hdGNoKC88dGl0bGU+KC4qPyk8XFwvdGl0bGU+LylbMV1cblx0XHRcdC50cmltKClcblx0XHRcdC5kZWNvZGVIVE1MKCk7XG5cdFx0XHRpbml0KCk7XG5cdFx0fVxuXHR9LFxuXG5cdGxvYWRQYWdlID0gZnVuY3Rpb24oaHJlZikge1xuXHRcdCRwYWdlLmxvYWQoaHJlZiArICcgI3BhZ2U+KicsIGFqYXhMb2FkKTtcblx0fTtcblxuXHRpbml0KCk7XG5cblx0JCh3aW5kb3cpLm9uKFwicG9wc3RhdGVcIiwgZnVuY3Rpb24oZSkge1xuXHRcdGlmIChlLm9yaWdpbmFsRXZlbnQuc3RhdGUgIT09IG51bGwpIHtcblx0XHRcdGxvYWRQYWdlKGxvY2F0aW9uLmhyZWYpO1xuXHRcdH1cblx0fSk7XG5cblx0JChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcImEsIFtkYXRhLWhyZWZdXCIsIGZ1bmN0aW9uKGV2KSB7XG5cdFx0dmFyIGhyZWYgPSAkKHRoaXMpLmF0dHIoXCJocmVmXCIpO1xuXHRcdHZhciBkYXRhQWpheCA9ICQodGhpcykuYXR0cihcImRhdGEtYWpheFwiKTtcblxuXHRcdGlmIChkYXRhQWpheCA9PSBcImZhbHNlXCIgfHwgaHJlZiA9PSB1bmRlZmluZWQgfHwgaHJlZiA9PSAnIycpIHsgcmV0dXJuOyB9XG5cblx0XHRldi5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0aWYgKGhyZWYuaW5kZXhPZihkb2N1bWVudC5kb21haW4pID4gLTEgfHwgaHJlZi5pbmRleE9mKCc6JykgPT09IC0xKSB7XG5cdFx0XHQvLyAkcHJlbG9hZGVyLnNob3coIDUwMCApO1xuXHRcdFx0aGlzdG9yeS5wdXNoU3RhdGUoe30sICcnLCBocmVmKTtcblx0XHRcdGxvYWRQYWdlKGhyZWYpO1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjb25zb2xlLmxvZygnW0lORk9dIEF0OiBjbGljay5kYXRhLWFqYXgnKTtcblx0XHR9XG5cdH0pO1xufSk7XG4iLCIvLyBSZWdleCBzdW1tYXJ5XG4vLyAuIEFueSBjaGFyYWN0ZXIgZXhjZXB0IG5ld2xpbmUuXG4vLyBcXC4gIEEgcGVyaW9kIChhbmQgc28gb24gZm9yIFxcKiwgXFwoLCBcXFxcLCBldGMuKVxuLy8gXiBUaGUgc3RhcnQgb2YgdGhlIHN0cmluZy5cbi8vICQgVGhlIGVuZCBvZiB0aGUgc3RyaW5nLlxuLy8gXFxkLFxcdyxcXHMgIEEgZGlnaXQsIHdvcmQgY2hhcmFjdGVyIFtBLVphLXowLTlfXSwgb3Igd2hpdGVzcGFjZS5cbi8vIFxcRCxcXFcsXFxTICBBbnl0aGluZyBleGNlcHQgYSBkaWdpdCwgd29yZCBjaGFyYWN0ZXIsIG9yIHdoaXRlc3BhY2UuXG4vLyBbYWJjXSBDaGFyYWN0ZXIgYSwgYiwgb3IgYy5cbi8vIFthLXpdIGEgdGhyb3VnaCB6LlxuLy8gW15hYmNdICBBbnkgY2hhcmFjdGVyIGV4Y2VwdCBhLCBiLCBvciBjLlxuLy8gYWF8YmIgRWl0aGVyIGFhIG9yIGJiLlxuLy8gPyBaZXJvIG9yIG9uZSBvZiB0aGUgcHJlY2VkaW5nIGVsZW1lbnQuXG4vLyAqIFplcm8gb3IgbW9yZSBvZiB0aGUgcHJlY2VkaW5nIGVsZW1lbnQuXG4vLyArIE9uZSBvciBtb3JlIG9mIHRoZSBwcmVjZWRpbmcgZWxlbWVudC5cbi8vIHtufSBFeGFjdGx5IG4gb2YgdGhlIHByZWNlZGluZyBlbGVtZW50LlxuLy8ge24sfSAgbiBvciBtb3JlIG9mIHRoZSBwcmVjZWRpbmcgZWxlbWVudC5cbi8vIHttLG59IEJldHdlZW4gbSBhbmQgbiBvZiB0aGUgcHJlY2VkaW5nIGVsZW1lbnQuXG4vLyA/PywqPywrPyxcbi8vIHtufT8sIGV0Yy4gIFNhbWUgYXMgYWJvdmUsIGJ1dCBhcyBmZXcgYXMgcG9zc2libGUuXG4vLyAoZXhwcikgIENhcHR1cmUgZXhwciBmb3IgdXNlIHdpdGggXFwxLCBldGMuXG4vLyAoPzpleHByKSAgTm9uLWNhcHR1cmluZyBncm91cC5cbi8vICg/PWV4cHIpICBGb2xsb3dlZCBieSBleHByLlxuLy8gKD8hZXhwcikgIE5vdCBmb2xsb3dlZCBieSBleHByLlxuXG4vLyBGb3VuZGF0aW9uIEphdmFTY3JpcHRcbi8vIERvY3VtZW50YXRpb24gY2FuIGJlIGZvdW5kIGF0OiBodHRwOi8vZm91bmRhdGlvbi56dXJiLmNvbS9kb2NzXG4kKGRvY3VtZW50KS5mb3VuZGF0aW9uKHtcbiBcbn0pO1xuXG4vKiAgW0dMT0JBTF0gRnVuY3Rpb25zXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuICBcbiAgU3RyaW5nLnByb3RvdHlwZS5jYXBpdGFsaXplRmlyc3RMZXR0ZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdGhpcy5zbGljZSgxKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGxvY2tfc2NyZWVuKCl7XG4gIH1cblxuICBmdW5jdGlvbiB1bmxvY2tfc2NyZWVuKCl7XG4gIH1cblxuICBmdW5jdGlvbiBjaGFpbl9vZl9ldmVudHMoZWwpe1xuICAgIGlmIChlbC5hdHRyKCdkYXRhLWV2ZW50cy1iZWZvcmUtcmVxdWVzdCcpKXtcbiAgICAgIHZhciBldmVudHMgPSBlbC5hdHRyKCdkYXRhLWV2ZW50cy1iZWZvcmUtcmVxdWVzdCcpLnNwbGl0KCcgJyk7XG5cbiAgICAgIGZvciAodmFyIGkgPSAwO2kgPCBldmVudHMubGVuZ3RoOyBpKyspe1xuICAgICAgICBlID0gZXZlbnRzW2ldLnRvU3RyaW5nKCk7XG4gICAgICAgIFxuICAgICAgICBzd2l0Y2goZSl7XG4gICAgICAgICAgY2FzZSAnYmVBY3RpdmUnOlxuICAgICAgICAgICAgJCgnYVtkYXRhLWV2ZW50c0JlZm9yZVJlcXVlc3Q9YmVBY3RpdmVdJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgZWwuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuXG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdmYWRlT3V0JzpcbiAgICAgICAgICAgIGVsLmZhZGVPdXQoKTtcblxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnYWRkRGF0YUluZGV4JzpcbiAgICAgICAgICAgIGVsID0gYWRkRGF0YUluZGV4KGVsKTtcblxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAncmVtb3ZlJzpcbiAgICAgICAgICAgIGlmIChldmVudHNbaSArIDFdKXtcbiAgICAgICAgICAgICAgJChldmVudHNbaSArIDFdKS5mYWRlT3V0KDEwMDAsIGZ1bmN0aW9uKCl7IFxuICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBlbC5mYWRlT3V0KDEwMDAsIGZ1bmN0aW9uKCl7IFxuICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGVsO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvY2Vzc19kYXRhKGRhdGEpe1xuICAgIGNvbnNvbGUubG9nKGRhdGEpXG4gICAgaWYgKGRhdGFbJ2FsZXJ0LXN1Y2Nlc3MnXSl7XG4gICAgICBhbGVydGlmeS5zdWNjZXNzKGRhdGFbJ2FsZXJ0LXN1Y2Nlc3MnXSk7XG4gICAgfSBcblxuICAgIGlmIChkYXRhWydhbGVydC1lcnJvciddKXtcbiAgICAgIGFsZXJ0aWZ5LmVycm9yKGRhdGFbJ2FsZXJ0LWVycm9yJ10pO1xuICAgIH1cblxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoZGF0YVsncmVkaXJlY3QnXSl7XG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZXBsYWNlKGRhdGFbJ3JlZGlyZWN0J10pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGRhdGFbJ2hyZWYnXSl7XG4gICAgICAgICAgZ2V0KGRhdGFbJ2hyZWYnXSk7ICAgICAgICBcbiAgICAgICAgfSBlbHNlIGlmIChkYXRhWyd0ZW1wbGF0ZSddKXtcbiAgICAgICAgICBpZihkYXRhWyd0YXJnZXQnXSl7XG4gICAgICAgICAgICAkKGRhdGFbJ3RhcmdldCddKS5odG1sKGRhdGFbJ3RlbXBsYXRlJ10pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICQoJyNwYWdlJykuaHRtbChkYXRhWyd0ZW1wbGF0ZSddKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBpZiAoZGF0YVsnYWxlcnQtc3VjY2VzcyddKXtcbiAgICAgICAgLy8gICBhbGVydGlmeS5zdWNjZXNzKGRhdGFbJ2FsZXJ0LXN1Y2Nlc3MnXSk7XG4gICAgICAgIC8vIH0gXG5cbiAgICAgICAgLy8gaWYgKGRhdGFbJ2FsZXJ0LWVycm9yJ10pe1xuICAgICAgICAvLyAgIGFsZXJ0aWZ5LmVycm9yKGRhdGFbJ2FsZXJ0LWVycm9yJ10pO1xuICAgICAgICAvLyB9XG4gICAgICB9XG4gICAgfSwgMTAwMCk7XG4gIH1cblxuICBmdW5jdGlvbiBiZWZvcmVfbG9hZCgpe1xuXG4gIH1cblxuICBmdW5jdGlvbiBnZXQodXJsLCBsb2NrKXtcbiAgICB2YXIgbG9jayA9ICh0eXBlb2YgbG9jayA9PT0gJ3VuZGVmaW5lZCcpID8gJ3RydWUnIDogbG9jaztcblxuICAgIGlmIChsb2NrID09ICd0cnVlJyl7XG4gICAgICBsb2NrX3NjcmVlbigpO1xuICAgIH1cblxuICAgICQuYWpheCh7XG4gICAgICB1cmwgICAgIDogdXJsLFxuICAgICAgdHlwZSAgICA6ICdnZXQnLFxuICAgICAgY2FjaGUgICA6IGZhbHNlLFxuICAgICAgc3VjY2VzcyA6IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICBwcm9jZXNzX2RhdGEoZGF0YSk7XG4gICAgICB9LFxuICAgICAgZXJyb3IgICA6IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICBhbGVydGlmeS5lcnJvcignRXJybyBkZXNjb25oZWNpZG8sIHBvciBmYXZvciBlbnRyYXIgZW0gY29udGF0byBjb20gb3MgYWRtaW5pc3RyYWRvcmVzIScpOyAgICAgXG4gICAgICB9LFxuICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICBiZWZvcmVfbG9hZCgpO1xuXG4gICAgICAgIGlmIChsb2NrID09ICd0cnVlJyl7XG4gICAgICAgICAgdW5sb2NrX3NjcmVlbigpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwb3N0KGZvcm0sIGxvY2spe1xuICAgIHZhciBsb2NrID0gKHR5cGVvZiBsb2NrID09PSAndW5kZWZpbmVkJykgPyAndHJ1ZScgOiBsb2NrOyAgIFxuICAgIFxuICAgIGlmIChsb2NrID09ICd0cnVlJyl7XG4gICAgICBsb2NrX3NjcmVlbigpOyBcbiAgICB9XG5cbiAgICBpZiAoZm9ybS5hdHRyKCdkYXRhLWN1c3RvbScpKXtcbiAgICAgIGlmICh0eXBlb2Ygd2luZG93W2Zvcm0uYXR0cignZGF0YS1jdXN0b20nKV0gPT09ICdmdW5jdGlvbicpe1xuICAgICAgICB2YXIgZGF0YSA9IHdpbmRvd1tmb3JtLmF0dHIoJ2RhdGEtY3VzdG9tJyldKGZvcm0pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgZGF0YSA9IGZvcm0uc2VyaWFsaXplKCk7XG4gICAgfVxuXG4gICAgdmFyIGNvbnRlbnQgPSAoZm9ybS5hdHRyKCdkYXRhLWNvbnRlbnQnKSA9PSAnZmFsc2UnKSA/IGZhbHNlIDogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDsgY2hhcnNldD1VVEYtOCc7XG4gICAgdmFyIHByb2Nlc3MgPSAoZm9ybS5hdHRyKCdkYXRhLXByb2Nlc3MnKSA9PSAnZmFsc2UnKSA/IGZhbHNlIDogdHJ1ZTsgXG5cbiAgICAkLmFqYXgoe1xuICAgICAgdXJsICAgICA6IGZvcm0uYXR0cignYWN0aW9uJyksXG4gICAgICB0eXBlICAgIDogZm9ybS5hdHRyKCdtZXRob2QnKSxcbiAgICAgIGRhdGEgICAgOiBkYXRhLFxuICAgICAgY2FjaGUgICA6IGZhbHNlLFxuICAgICAgY29udGVudFR5cGU6IGNvbnRlbnQsXG4gICAgICBwcm9jZXNzRGF0YTogcHJvY2VzcyxcbiAgICAgIHN1Y2Nlc3MgOiBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgcHJvY2Vzc19kYXRhKGRhdGEpO1xuICAgICAgfSxcbiAgICAgIGVycm9yICAgOiBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgYWxlcnRpZnkuZXJyb3IoJ0Vycm8gZGVzY29uaGVjaWRvLCBwb3IgZmF2b3IgZW50cmFyIGVtIGNvbnRhdG8gY29tIG9zIGFkbWluaXN0cmFkb3JlcyEnKTsgICAgXG4gICAgICB9LFxuICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICBiZWZvcmVfbG9hZCgpO1xuXG4gICAgICAgIGlmIChsb2NrID09ICd0cnVlJyl7XG4gICAgICAgICAgdW5sb2NrX3NjcmVlbigpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuLyogIFtHTE9CQUxdIENhbGxzXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG4gICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICdhW2RhdGEtZ2V0XScsIGZ1bmN0aW9uKGUpe1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgIGVsID0gJCh0aGlzKTtcblxuICAgIGlmICghZWwuaGFzQ2xhc3MoJ2FjdGl2ZScpKXtcblxuICAgICAgaWYgKGVsLmF0dHIoJ2RhdGEtY29uZmlybScpKXtcbiAgICAgICAgYWxlcnRpZnkuc2V0KHsgbGFiZWxzIDogeyBvazogXCJTaW1cIiwgY2FuY2VsOiBcIk7Dg8Kjb1wiIH0gfSk7XG4gICAgICAgIFxuICAgICAgICBhbGVydGlmeS5jb25maXJtKGVsLmF0dHIoJ2RhdGEtY29uZmlybScpLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICBlbCA9IGNoYWluX29mX2V2ZW50cyhlbCk7XG5cbiAgICAgICAgICAgIGdldChlbC5hdHRyKCdkYXRhLWdldCcpLCBlbC5hdHRyKCdkYXRhLWxvY2snKSk7IFxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhbGVydGlmeS5sb2coJ0HDg8Knw4PCo28gY2FuY2VsYWRhLicpXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVsID0gY2hhaW5fb2ZfZXZlbnRzKGVsKTtcblxuICAgICAgICBnZXQoZWwuYXR0cignZGF0YS1nZXQnKSwgZWwuYXR0cignZGF0YS1sb2NrJykpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJ1tkYXRhLXN1Ym1pdF0nLCBmdW5jdGlvbihlKXtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICB2YXIgZWwgPSAkKHRoaXMpO1xuICAgIHZhciBmb3JtID0gZWwuY2xvc2VzdCgnZm9ybScpO1xuICAgIHZhciBmb3JtX3ZhbGlkID0gdHJ1ZTtcbiAgICB2YXIgcmVxdWlyZWRfZmllbGRzID0gZm9ybS5maW5kKCdbZGF0YS1yZXF1aXJlZF0nKTtcblxuICAgIHJlcXVpcmVkX2ZpZWxkcy5lYWNoKGZ1bmN0aW9uKGluZGV4KXtcbiAgICAgIHZhciBmaWVsZCA9ICQodGhpcyk7XG4gICAgICB2YXIgZXJyb3JfbXNnID0gZmllbGQuYXR0cignZGF0YS1yZXF1aXJlZCcpO1xuXG4gICAgICBpZiAoZmllbGQudmFsKCkgPT0gJycgfHwgZmllbGQudmFsKCkgPT0gMCl7XG4gICAgICAgIGZpZWxkLmFkZENsYXNzKCdpbnZhbGlkJyk7XG4gICAgICAgIGFsZXJ0aWZ5LmVycm9yKGVycm9yX21zZyk7XG4gICAgICAgIGZvcm1fdmFsaWQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgICBpZiAoZm9ybS5hdHRyKCdkYXRhLWRlZmF1bHQnKSl7XG4gICAgICBmb3JtLnN1Ym1pdCgpO1xuICAgIH0gZWxzZSBpZiAoZm9ybV92YWxpZCl7XG4gICAgICBwb3N0KGZvcm0sIGZvcm0uYXR0cignZGF0YS1sb2NrJykpO1xuICAgIH0gXG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH0pXG5cbiAgJChkb2N1bWVudCkub24oJ3N1Ym1pdCcsICdmb3JtJywgZnVuY3Rpb24oKXtcbiAgICB2YXIgZWwgPSAkKHRoaXMpO1xuICAgIHZhciBmb3JtX3ZhbGlkID0gdHJ1ZTtcbiAgICB2YXIgcmVxdWlyZWRfZmllbGRzID0gZWwuZmluZCgnW2RhdGEtcmVxdWlyZWRdJyk7XG5cbiAgICByZXF1aXJlZF9maWVsZHMuZWFjaChmdW5jdGlvbihpbmRleCl7XG4gICAgICB2YXIgZmllbGQgPSAkKHRoaXMpO1xuICAgICAgdmFyIGVycm9yX21zZyA9IGZpZWxkLmF0dHIoJ2RhdGEtcmVxdWlyZWQnKTtcblxuICAgICAgaWYgKGZpZWxkLnZhbCgpID09ICcnIHx8IGZpZWxkLnZhbCgpID09IDApe1xuICAgICAgICBmaWVsZC5hZGRDbGFzcygnaW52YWxpZCcpO1xuICAgICAgICBhbGVydGlmeS5lcnJvcihlcnJvcl9tc2cpO1xuICAgICAgICBmb3JtX3ZhbGlkID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSk7XG4gICAgXG4gICAgaWYgKGVsLmF0dHIoJ2RhdGEtZGVmYXVsdCcpKXtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSBpZiAoZm9ybV92YWxpZCl7XG4gICAgICBwb3N0KGVsLCBlbC5hdHRyKCdkYXRhLWxvY2snKSk7XG4gICAgfSBcblxuICAgIHJldHVybiBmYWxzZTtcbiAgfSk7XG4gICQoJyN2aXNpYmlsaXR5JykuY2hhbmdlKGZ1bmN0aW9uKCl7XG4gICAgICAgY2IgPSAkKHRoaXMpO1xuICAgICAgIGNiLnZhbChjYi5wcm9wKCdjaGVja2VkJykudG9TdHJpbmcoKS5jYXBpdGFsaXplRmlyc3RMZXR0ZXIoKSk7XG4gICB9KTsgICJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==